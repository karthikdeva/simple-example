/*
  filename: angular.integralui.treeview.min.js
  version : 3.1.017
  Copyright Â© 2014-2016 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeViewService",["$rootScope",function(c){var k=null;return{addItem:function(e,h,f){c.$broadcast(e+"-add-item",h,f)},clearItems:function(e,h){c.$broadcast(e+"-clear-items",h)},insertItemAt:function(e,h,f,k){c.$broadcast(e+"-insert-item-at",h,f,k)},insertItemBefore:function(e,h,f){c.$broadcast(e+"-insert-item-before",h,f)},insertItemAfter:function(e,h,f){c.$broadcast(e+"-insert-item-after",h,f)},removeItem:function(e,h){c.$broadcast(e+"-remove-item",
h)},removeItemAt:function(e,h,f){c.$broadcast(e+"-remove-item-at",h,f)},exportToJSON:function(e,h,f,k){c.$broadcast(e+"-export-json",h,f,k);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,h,f,k,g){c.$broadcast(e+"-load-data",h,f,k,g)},openEditor:function(e,h){c.$broadcast(e+"-open-editor",h)},closeEditor:function(e,h){c.$broadcast(e+"-close-editor",h)},collapse:function(e,h){c.$broadcast(e+"-collapse",h)},expand:function(e,h){c.$broadcast(e+"-expand",h)},toggle:function(e,
h){c.$broadcast(e+"-toggle",h)},findItemById:function(e,h){c.$broadcast(e+"-find-item-by-id",h);var f=this.getTempData();this.clearTempData();return f?f:null},findItemByText:function(e,h){c.$broadcast(e+"-find-item-by-text",h);var f=this.getTempData();this.clearTempData();return f?f:null},getItemParent:function(e,h){c.$broadcast(e+"-get-item-parent",h);var f=this.getTempData();this.clearTempData();return f?f:null},getItemAt:function(e,h){c.$broadcast(e+"-get-item-at",h);var f=this.getTempData();this.clearTempData();
return f?f:null},filter:function(e,h){c.$broadcast(e+"-filter",h)},focus:function(e,h){c.$broadcast(e+"-focus",h)},clearTempData:function(){k=null},ensureVisible:function(e,h,f){c.$broadcast(e+"-ensure-visible",h,f)},getCheckList:function(e,h){c.$broadcast(e+"-get-check-list",h);var f=this.getTempData();this.clearTempData();return f?f:[]},getItemLevel:function(e,h){c.$broadcast(e+"-get-item-level",h);var f=this.getTempData();this.clearTempData();return f?f:0},getFlatList:function(e,h){c.$broadcast(e+
"-get-flat-list",h);var f=this.getTempData();this.clearTempData();return f?f:[]},getFullPath:function(e,h){c.$broadcast(e+"-get-full-path",h);var f=this.getTempData();this.clearTempData();return f?f:""},getList:function(e,h,f){c.$broadcast(e+"-get-list",h,f);e=this.getTempData();this.clearTempData();return e?e:[]},getTempData:function(){return k},setTempData:function(c){k=c},beginLoad:function(e,h,f){c.$broadcast(e+"-begin-load",h,f)},endLoad:function(e,h){c.$broadcast(e+"-end-load",h)},moveItem:function(e,
h,f,k,g){c.$broadcast(e+"-move-item",h,f,k,g)},clearSelection:function(e){c.$broadcast(e+"-clear-selection")},selectedItem:function(e,h){if(h)c.$broadcast(e+"-set-selected-item",h);else{c.$broadcast(e+"-get-selected-item");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedItems:function(e,h){if(h)c.$broadcast(e+"-set-selected-items",h);else{c.$broadcast(e+"-get-selected-items");var f=this.getTempData();this.clearTempData();return f?f:null}},getScrollPos:function(e){c.$broadcast(e+
"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,h){c.$broadcast(e+"-set-scroll-pos",h)},scrollTo:function(e,h,f){c.$broadcast(e+"-scroll-to",h,f)},sort:function(e,h,f){c.$broadcast(e+"-sort",h,f)},updateCheckValues:function(e,h){c.$broadcast(e+"-update-check",h)},refresh:function(e,h,f){c.$broadcast(e+"-refresh",h,f)},resumeLayout:function(e){c.$broadcast(e+"-resume-layout")},suspendLayout:function(e){c.$broadcast(e+"-suspend-layout")},updateLayout:function(e){c.$broadcast(e+
"-update-layout")},updateView:function(e){c.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeViewController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeViewService","IntegralUIDragDrop","IntegralUIFilter",function(c,k,e,h,f,J,g,l,Qa){var a=this;a.hoverItem=null;this.suppressProcess=!1;a.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",
indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};a.defaultStyle={general:"iui-treeview",item:{general:{disabled:"iui-treeview-item-disabled",focused:"iui-treeview-item-focused",normal:"iui-treeview-item",hovered:"iui-treeview-item-hovered",selected:"iui-treeview-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},
expandBox:{general:"iui-treeview-expand-box",animated:"iui-treeview-expand-box-load",expanded:"iui-treeview-expand-box-open",collapsed:"iui-treeview-expand-box-close"},content:{disabled:"iui-treeview-item-content-disabled",focused:"iui-treeview-item-content-focused",normal:"iui-treeview-item-content",hovered:"iui-treeview-item-content-hovered",selected:"iui-treeview-item-content-selected"}}};a.defaultCheckBoxSettings={autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1};this.updateOptions=function(b){b?
(a.options={allowAnimation:f.isFieldAvailable(b.allowAnimation,!0),allowDrag:f.isFieldAvailable(b.allowDrag,!1),allowDrop:f.isFieldAvailable(b.allowDrop,!0),allowFocus:f.isFieldAvailable(b.allowFocus,!0),animationSpeed:200,autoCheck:f.isFieldAvailable(b.autoCheck,!1),autoExpand:f.isFieldAvailable(b.autoExpand,!0),checkBoxSettings:a.defaultCheckBoxSettings,controlStyle:a.defaultStyle,editorSettings:{activate:"click"},enabled:f.isFieldAvailable(b.enabled,!0),hoverSelection:f.isFieldAvailable(b.hoverSelection,
!1),indent:f.isFieldAvailable(b.indent,15),itemIcon:f.isFieldAvailable(b.itemIcon,""),itemSpacing:f.isFieldAvailable(b.itemSpacing,1),labelEdit:f.isFieldAvailable(b.labelEdit,!1),loadItems:[],pathSeparator:f.isFieldAvailable(b.pathSeparator,"\\"),rtl:f.isFieldAvailable(b.rtl,!1),selectedIndex:-1,selectedItem:f.isFieldAvailable(b.selectedItem,a.options.selectedItem?a.options.selectedItem:null),selectedItems:[],selectionMode:f.isFieldAvailable(b.selectionMode,"one"),showCheckBoxes:f.isFieldAvailable(b.showCheckBoxes,
!1),showExpandBoxes:f.isFieldAvailable(b.showExpandBoxes,!0),showIcons:f.isFieldAvailable(b.showIcons,!0),showLines:f.isFieldAvailable(b.showLines,!1),showStatusIcons:f.isFieldAvailable(b.showStatusIcons,!1),sorting:f.isFieldAvailable(b.sorting,"none")},a.updateDataFields(b.dataFields),a.updateControlStyle(b.controlStyle),a.updateCheckBoxSettings(b.checkBoxSettings),a.updateTemplateSettings(b.templateSettings)):(a.options={allowAnimation:!0,allowDrag:!1,allowDrop:!0,allowFocus:!0,animationSpeed:200,
autoCheck:!1,autoExpand:!0,checkBoxSettings:a.defaultCheckBoxSettings,controlStyle:a.defaultStyle,editorSettings:{activate:"click"},enabled:!0,hoverSelection:!1,indent:15,itemIcon:"",itemSpacing:1,labelEdit:!1,loadItems:[],pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,selectedItems:[],selectionMode:"one",showCheckBoxes:!1,showExpandBoxes:!0,showIcons:!0,showLines:!1,showStatusIcons:!1,sorting:"none",templateSettings:{url:null}},a.updateDataFields())};a.options={};this.updateDataFields=
function(b){a.options.dataFields=b?{allowDrag:b.allowDrag?b.allowDrag:"allowDrag",allowDrop:b.allowDrop?b.allowDrop:"allowDrop",allowEdit:b.allowEdit?b.allowEdit:"allowEdit",allowFocus:b.allowFocus?b.allowFocus:"allowFocus",autoCheck:b.autoCheck?b.autoCheck:"autoCheck",checkBoxSettings:b.checkBoxSettings?b.checkBoxSettings:"checkBoxSettings",checked:b.checked?b.checked:"checked",checkState:b.checkState?b.checkState:"checkState",content:b.content?b.content:"content",contextMenu:b.contextMenu?b.contextMenu:
"contextMenu",enabled:b.enabled?b.enabled:"enabled",expanded:b.expanded?b.expanded:"expanded",hasChildren:b.hasChildren?b.hasChildren:"hasChildren",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",items:b.items?b.items:"items",pid:b.pid?b.pid:"pid",statusIcon:b.statusIcon?b.statusIcon:"statusIcon",style:b.style?b.style:"style",templateObj:b.templateObj?b.templateObj:"templateObj",text:b.text?b.text:"text",tooltip:b.tooltip?b.tooltip:"tooltip",value:b.value?b.value:"value"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",
allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value"};a.dataObj&&a.dataObj.updateDataFields(a.options.dataFields)};this.updateTemplateSettings=function(b){a.options.templateSettings=
b?{display:f.isFieldAvailable(b.display,"block"),url:f.isFieldAvailable(b.url,null)}:{display:"block",url:null}};a.updateOptions();c.$on(c.name+"-add-item",function(b,d,c){a.dataObj.insertAt(d,-1,c,a.itemIsAdded)});c.$on(c.name+"-clear-items",function(b,d){a.dataObj.clear(d,a.listIsCleared)});c.$on(c.name+"-insert-item-at",function(b,d,c,p){a.dataObj.insertAt(d,c,p,a.itemIsAdded)});c.$on(c.name+"-insert-item-after",function(b,d,c){a.dataObj.insertByRef(d,c,!0,a.itemIsAdded)});c.$on(c.name+"-insert-item-before",
function(b,d,c){a.dataObj.insertByRef(d,c,!1,a.itemIsAdded)});c.$on(c.name+"-remove-item",function(b,d){a.dataObj.removeAt(d,-1,null,a.itemIsRemoved)});c.$on(c.name+"-remove-item-at",function(b,d,c){a.dataObj.removeAt(null,d,c,a.itemIsRemoved)});this.listIsCleared=function(b){b||(a.clearPrevSelection(),a.options.selectedItem=null,a.setScrollPos({x:0,y:0}));a.updateCurrentLayout()};this.itemIsAdded=function(){a.updateCurrentLayout()};this.itemIsRemoved=function(b,d,c,p){b&&(b.selected=!1,b==a.options.selectedItem&&
(a.options.selectedItem=null));a.updateCurrentLayout()};this.objIsRemoved=function(b,d,c){a.updateCurrentLayout()};this.getCheckValue=function(b){return"checked"==b[a.options.dataFields.checkState]?"checked":1==a.options.checkBoxSettings.threeState&&"indeterminate"==b[a.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(b){if(1==a.options.autoCheck||1==a.options.checkBoxSettings.autoCheck){var d=a.getCheckValue(b);if(!1!==(1==a.options.checkBoxSettings.threeState?
a.callCheckValueChanging(b,d):a.callCheckValueChanging(b,"checked"==d?!0:!1))){if(1==a.options.checkBoxSettings.threeState)switch(d){case "checked":d="unchecked";break;case "indeterminate":d="checked";break;case "unchecked":d="indeterminate"}else d="unchecked"==d||"indeterminate"==d?"checked":"unchecked";b[a.options.dataFields.checkState]=d;b[a.options.dataFields.checked]="checked"==d?!0:!1;c.$apply()}}};this.callCheckValueChanging=function(b,d){var r=!0;a.allowEvents&&(r=1==a.options.checkBoxSettings.threeState?
angular.isDefined(c.events)&&c.events.itemCheckstateChanging?c.events.itemCheckstateChanging({item:b,value:d}):c.itemCheckstateChanging({e:{item:b,value:d}}):angular.isDefined(c.events)&&c.events.itemCheckedChanging?c.events.itemCheckedChanging({item:b,value:d}):c.itemCheckedChanging({e:{item:b,value:d}}));return r};this.callCheckValueChanged=function(b,d){a.allowEvents&&(retValue=1==a.options.checkBoxSettings.threeState?angular.isDefined(c.events)&&c.events.itemCheckstateChanged?c.events.itemCheckstateChanged({item:b,
value:d}):c.itemCheckstateChanged({e:{item:b,value:d}}):angular.isDefined(c.events)&&c.events.itemCheckedChanged?c.events.itemCheckedChanged({item:b,value:d}):c.itemCheckedChanged({e:{item:b,value:d}}))};var L=[],I=!1;this.fillCheckList=function(b){if(a.allowEvents&&b&&1==a.options.checkBoxSettings.threeState&&!I){I=!0;L.length=0;L.push({item:b,value:b[a.options.dataFields.checkState]});a.updateListChildItemCheckValue(b);a.updateListParentItemCheckValue(b);for(var d=0,d=0;d<L.length;d++)L[d].item[a.options.dataFields.checkState]=
L[d].value;var c=e(function(){d==L.length&&(I=!1);e.cancel(c)},1)}};this.getItemCheckValue=function(b){for(var d="unchecked",c=!1,p=0;p<L.length;p++)if(L[p].item==b){c=!0;d=L[p].value;break}c||(d=b[a.options.dataFields.checkState]);return d};this.updateListParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var d=b[a.options.dataFields.items];if(d){for(var c=0,p=0,f=0;f<d.length;f++){var e=a.getItemCheckValue(d[f]);"checked"==e?c++:"indeterminate"==e&&p++}f={item:b};f.value=c==d.length?"checked":
0<c||0<p?"indeterminate":"unchecked";L.push(f)}b=a.getParent(b)}};this.updateListChildItemCheckValue=function(b){if(b){var d=b[a.options.dataFields.items];if(d)for(var c=0;c<d.length;c++){var p={item:d[c]};"checked"==a.getItemCheckValue(b)?p.value="checked":p.value="unchecked";L.push(p);a.updateListChildItemCheckValue(d[c])}}};this.updateParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var d=b[a.options.dataFields.items];if(d){for(var c=0,p=0,f=0;f<d.length;f++)"checked"==d[f][a.options.dataFields.checkState]?
c++:"indeterminate"==d[f][a.options.dataFields.checkState]&&p++;b[a.options.dataFields.checkState]=c==d.length?"checked":0<c||0<p?"indeterminate":"unchecked"}b=a.getParent(b)}};this.updateItemCheckValue=function(b,d){if("checked"==d||"unchecked"==d)b[a.options.dataFields.checkState]=d;var c=b[a.options.dataFields.items];if(c&&0<c.length)for(var p=0;p<c.length;p++)a.updateItemCheckValue(c[p],b[a.options.dataFields.checkState]);void 0!=b[a.options.dataFields.checkState]&&(c=a.getParent(b))&&c[a.options.dataFields.checkState]!=
b[a.options.dataFields.checkState]&&a.updateParentItemCheckValue(b)};this.updateCheckValues=function(b){if(1==a.options.checkBoxSettings.threeState){b=a.dataObj.getList(b);for(var d=0;d<b.length;d++)a.updateItemCheckValue(b[d])}};c.$on(c.name+"-update-check",function(b,d){a.updateCheckValues(d)});c.$on(c.name+"-get-check-list",function(b,d){a.updateCheckValues();void 0==d&&(d=1==a.options.checkBoxSettings.threeState?"checked":!0);var c=1==a.options.checkBoxSettings.threeState?a.options.dataFields.checkState:
a.options.dataFields.checked,p={operation:"=",value:d},c=Qa.filter(a.getFullList(),c,p);g.setTempData(c)});this.updateCheckBoxSettings=function(b){a.options.checkBoxSettings=b?{autoCheck:f.isFieldAvailable(b.autoCheck,!1),style:Ra(b.style),threeState:f.isFieldAvailable(b.threeState,!1)}:{autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1}};var w=function(a){return a?Qa.createTree(a.conditions,a.formula):null},t=function(b){var d=!0;b&&a.filterParams&&(d=(d=b[a.options.dataFields.value])?d:b[a.options.dataFields.text],
d=a.filterParams.callback?a.filterParams.callback(d,b):Qa.match(d,a.filterParams.conditions,a.filterParams.formula,w(a.filterParams)));return d},q=0;a.currentList=[];a.indentList=[];a.parentList=[];a.longestItem=null;a.isThereChildItems=!1;this.updateLongestItem=function(){a.longestItem=null;for(var b=q=0;b<a.currentList.length;b++){var d=a.currentList[b];if(d[a.options.dataFields.text]){var c=d[a.options.dataFields.text].length;0<a.options.indent&&(c+=a.indentList[b]/a.options.indent);q<c&&(q=c,
a.longestItem=d)}}};var M=function(b,d,c,p,e){b.type="item";b[a.options.dataFields.id]||(b[a.options.dataFields.id]=f.getUniqueId());c&&(b[a.options.dataFields.pid]=c);if(c=t(b))p?a.fullList.push(b):(p=d,0!=a.options.showStatusIcons&&(p+=15),a.currentList.push(b),a.indentList.push(p),a.parentList.push({parent:e}),b[a.options.dataFields.text]&&(e=b[a.options.dataFields.text].length,0<a.options.indent&&(e+=d/a.options.indent),0!=a.options.showStatusIcons&&(e+=15),q<e&&(q=e,a.longestItem=b)));return c};
this.isThereVisibleChildren=function(b){var d=!1;if(b&&(b=b[a.options.dataFields.items]))for(var c=0;c<b.length;c++)if(t(b[c])){d=!0;break}return d};this.isThereChildItems=!1;var Q=function(b,d,c,p,f){if(!b[a.options.dataFields.items])return c=M(b,d,c,p,f);if(c=M(b,d,c,p,f)){f=0;var e;if(p||a.isItemExpanded(b)){var g=b[a.options.dataFields.items];if(g){a.applySorting(g);for(var h=0;h<g.length;h++)(e=Q(g[h],d+a.options.indent,b[a.options.dataFields.id],p,b))&&f++}}p||a.isThereChildItems||!(0<f||!a.isItemExpanded(b)&&
b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&a.isThereVisibleChildren(b))||(a.isThereChildItems=!0)}return c};a.fullList=[];this.getFullList=function(b){a.fullList.length=0;b=a.dataObj.getList(b);for(var d=0;d<b.length;d++)Q(b[d],0,null,!0,null);return a.fullList};this.getCurrentList=function(){return a.currentList};this.updateCurrentList=function(){a.currentList.length=0;a.indentList.length=0;a.parentList.length=0;a.longestItem=null;a.isThereChildItems=!1;q=0;var b=a.dataObj.getList();
if(b){a.applySorting(b);for(var d=0;d<b.length;d++)Q(b[d],0,null,!1)}};this.dataEvents={clear:function(a){return angular.isDefined(c.events)&&c.events.clear?c.events.clear({parent:a.e.parent}):c.clear(a)},objAdded:function(a){return angular.isDefined(c.events)&&c.events.itemAdded?c.events.itemAdded({item:a.e.item}):c.itemAdded(a)},objAdding:function(a){return angular.isDefined(c.events)&&c.events.itemAdding?c.events.itemAdding({item:a.e.item}):c.itemAdding(a)},objRemoved:function(a){return angular.isDefined(c.events)&&
c.events.itemRemoved?c.events.itemRemoved({item:a.e.item}):c.itemRemoved(a)},objRemoving:function(a){return angular.isDefined(c.events)&&c.events.itemRemoving?c.events.itemRemoving({item:a.e.item}):c.itemRemoving(a)}};this.getDataFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",pid:a.pid?a.pid:"pid",objects:a.items?a.items:"items",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",text:a.text?a.text:"text"}};a.dataObj=new J({objects:c.items,
events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)});c.$on(c.name+"-load-data",function(b,d,c,f,e){a.loadData(d,c,f,e)});c.$on(c.name+"-export-json",function(b,d,c,f){g.setTempData(a.exportToJSON(d,c,f))});this.exportToJSON=function(b,d,c){c=c?c:null;var f=!1!==d?a.getFullList():a.dataObj.getList();b=b?b:[a.options.dataFields.allowDrag,a.options.dataFields.allowDrop,a.options.dataFields.allowEdit,a.options.dataFields.allowFocus,a.options.dataFields.autoCheck,a.options.dataFields.checkBoxSettings,
a.options.dataFields.checked,a.options.dataFields.checkState,a.options.dataFields.content,a.options.dataFields.contextMenu,a.options.dataFields.enabled,a.options.dataFields.expanded,a.options.dataFields.hasChildren,a.options.dataFields.icon,a.options.dataFields.id,a.options.dataFields.pid,a.options.dataFields.statusIcon,a.options.dataFields.style,a.options.dataFields.templateObj,a.options.dataFields.text,a.options.dataFields.tooltip,a.options.dataFields.value];!1===d&&b.push(a.options.dataFields.items);
return JSON.stringify(f,b,c)};this.loadData=function(b,d,r,f){a.suspendLayout();a.allowEvents=!1;a.updateDataFields(r);var g=[],h=a.options.dataFields;a.dataObj.clear(d,a.listIsCleared);if(b)if(0!=f){var k=[];b.forEach(function(a,b){var d=a[h.pid];k[d]?(k[d][h.items]||(k[d][h.items]=[]),k[a[h.id]]=a,k[d][h.items].push(a)):(k[a[h.id]]=a,g.push(a))});k.length=0}else g=b;if(d)for(d[a.options.dataFields.items]=g,b=0;b<d[a.options.dataFields.items].length;b++)d[a.options.dataFields.items][b][a.options.dataFields.pid]=
d[a.options.dataFields.id];else if(angular.isDefined(c.items))for(b=c.items.length=0;b<g.length;b++)c.items.push(g[b]);a.dataObj=new J({objects:c.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)});var l=e(function(){a.getTemplateUrl();a.resumeLayout();a.allowEvents=!0;e.cancel(l)},100)};this.updateData=function(){a.options.dataFields.dataSource&&(a.loadData(a.options.dataFields.dataSource),a.dataObj=new J({objects:c.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)}))};
var T=!1;this.dragDropStatus=function(a){if(void 0!=a)T=a;else return T};this.getDnDSource=function(a){return{text:a.dataTransfer?a.dataTransfer.getData("text"):a.originalEvent.dataTransfer?a.originalEvent.dataTransfer.getData("text"):""}};this.getTouchData=function(a){return a.changedTouches?a.changedTouches:a.originalEvent?a.originalEvent.changedTouches:null};var ia=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};
angular.element(h).bind("dragenter",function(b){a.dropMark()});angular.element(h).bind("dragend",function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer()});a.getMousePos=function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}};this.getCtrlName=function(){return angular.isDefined(c.name)?c.name:""};k.bind("dragenter",function(b){b.preventDefault();if(a.options.enabled){var d=
l.getData();d.source||(d.source=a.getDnDSource(b));b={event:b,sourceTree:d.sourceCtrl?d.sourceCtrl.getCtrlName():"",dragItem:d.source,targetTree:a.getCtrlName(),targetItem:d.target,mousePos:a.getMousePos(b)};a.callDragEnter(b)}});k.bind("dragover",function(b){b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(a.options.enabled&&d)if(b.dataTransfer?b.dataTransfer.dropEffect=
a.options.allowDrop?"move":"none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect=a.options.allowDrop?"move":"none"),d=l.getData(),d.source||(d.source=a.getDnDSource(b)),l.setData({source:d.source,sourceCtrl:d.sourceCtrl,target:null,dropPos:-1}),d={event:b,sourceTree:d.sourceCtrl?d.sourceCtrl.getCtrlName():"",dragItem:d.source,targetTree:a.getCtrlName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)},0==a.callDragOver(d))b.dataTransfer?
b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark();else{d=a.getMousePos(b);b=d.y+16;var d=d.x+20,r=a.getDropMarkWindow();r.empty();r.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(c.name?c.name:"TreeView")+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:d});a.dropMark(!0)}});k.bind("drop",function(b){b.preventDefault();a.dropMark();var d=!0;b.dataTransfer?
d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(a.options.enabled&&d&&(d=l.getData(),d.source||(d.source=a.getDnDSource(b)),d.source)){var r={event:b,sourceTree:d.sourceCtrl?d.sourceCtrl.getCtrlName():"",dragItem:d.source,targetTree:a.getCtrlName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};!1!==a.callDragDrop(r)&&(a.drop(d),c.$$phase||c.$apply())}l.clearData();
b.stopPropagation()});k.bind("dragleave",function(b){b.preventDefault();if(a.options.enabled){a.dropMark();var d=l.getData();d.source||(d.source=a.getDnDSource(b));b={event:b,sourceTree:d.sourceCtrl?d.sourceCtrl.getCtrlName():"",dragItem:d.source,targetTree:a.getCtrlName(),targetItem:d.target,mousePos:a.getMousePos(b)};a.callDragLeave(b);a.cancelScrollTimer()}});k.bind("dragend",function(b){b.preventDefault();a.options.enabled&&(a.dropMark(),l.getData().source||l.clearData(),a.dragDropStatus(!1))});
k.bind("mouseleave",function(b){b.preventDefault();a.dropMark();a.hoverItem=null});this.containsMousePos=function(a,d){return l.hitTest(a,d,{left:0,top:0,right:k[0].clientWidth,bottom:k[0].clientHeight})};this.isPopupActive=function(){return!1};var u=function(b,d){var c=a.options.dataFields;b[c.items]||(b[c.items]=[]);b[c.items].length=0;if(b[d.rows]&&0<b[d.rows].length)for(var f=0;f<b[d.rows].length;f++)b[c.items].push(u(b[d.rows][f],d));return b},Da=function(b,d){var c=!1;d.sourceCtrl&&(c=d.sourceCollection.removeAt(b,
-1,null,d.sourceCtrl.objIsRemoved));c&&("row"==b.type&&(b=u(b,d.sourceCtrl.options.rowFields)),0===d.dropPos?a.dataObj.insertAt(b,-1,d.target,a.itemIsAdded):1===d.dropPos||2===d.dropPos?1===d.dropPos?a.dataObj.insertByRef(b,d.target,!1,a.itemIsAdded):a.dataObj.insertByRef(b,d.target,!0,a.itemIsAdded):a.dataObj.insertAt(b,-1,null,a.itemIsAdded))};this.setDropSelection=function(b,d){var c=b;!c&&0<=d&&d<a.currentList.length&&(c=a.currentList[d]);a.clearPrevSelection(c);a.itemSelection(null,c)};this.drop=
function(b){if(b&&b.sourceCtrl){b.sourceCtrl.suppressProcess=!0;b.sourceCtrl.suspendLayout();a.suspendLayout();var d=b.source;if(Array.isArray(b.source)){for(var r=[],f=0;f<b.source.length;f++){for(var g=!1,h=b.sourceCollection.getParent(b.source[f]);h;){if(b.sourceCtrl.isObjInSelList(h)){g=!0;break}h=b.sourceCollection.getParent(h)}g||r.push(b.source[f])}if(0<r.length)if(d=r[r.length-1],f=b.sourceCtrl.getObjCurrentIndex(r[0]),g=b.sourceCtrl.getObjCurrentIndex(d),f<=g)for(f=0;f<r.length;f++)Da(r[f],
b);else for(f=r.length-1;0<=f;f--)Da(r[f],b)}else Da(b.source,b);b.sourceCtrl!==a?(a.allowUpdate=!0,b.sourceCtrl.allowUpdate=!0,a.updateCurrentLayout(),b.sourceCtrl.updateCurrentLayout()):(a.allowUpdate=!0,a.updateCurrentLayout());b.sourceCtrl.multiSelection(!1);var k=e(function(){if(d){b.sourceCtrl.clearPrevSelection(d);a.itemSelection(null,d);var f=a.getElemFromItem(d);f&&(f=a.getElement(f))&&f[0].focus();c.$apply();e.cancel(k)}},1);b.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(b){return a.options.allowDrag?
b&&(b[a.options.dataFields.allowDrag]||void 0===b[a.options.dataFields.allowDrag])?!0:!1:!1};this.isChildOf=function(b,d){var c=!1;if(b&&d){var e=d[a.options.dataFields.items];if(e&&0<e.length)for(var g=0;g<e.length;g++){if(f.isEqual(b[a.options.dataFields.id],e[g][a.options.dataFields.id])){c=!0;break}else c=a.isChildOf(b,e[g]);if(c)break}}return c};this.isParentOf=function(b,d){var c=a.dataObj.getParent(d);return b&&d&&c&&f.isEqual(b[a.options.dataFields.id],c[a.options.dataFields.id])?!0:!1};this.isDropAllowed=
function(b,d,c){var e=a.options.allowDrop;if(e&&b&&d&&(e=d[a.options.dataFields.allowDrop]||void 0===d[a.options.dataFields.allowDrop]?!0:!1))if(Array.isArray(b))for(var g=0;g<b.length;g++){if(f.isEqual(b[g][a.options.dataFields.id],d[a.options.dataFields.id])||0===c&&a.isParentOf(d,b[g])||a.isChildOf(d,b[g])){e=!1;break}if(!e)break}else if(f.isEqual(b[a.options.dataFields.id],d[a.options.dataFields.id])||0===c&&a.isParentOf(d,b)||a.isChildOf(d,b))e=!1;return e};this.getDropMarkWindow=function(){for(var a=
ia,d=angular.element(document.body).children(),c=0;c<d.length;c++){var f=angular.element(d[c]);if(f[0].attributes&&f[0].attributes["data-element"]&&"dropmark"===f[0].attributes["data-element"].value){a=f;break}}return a};this.dropMark=function(b,d){d||(d=a.getDropMarkWindow());if(d){var c="none";this.options.allowDrop&&(c=b?"block":"none");angular.element(d).css("display",c)}};this.updateDropMarkElem=function(a,d){a&&d&&(a.css("top",d.top+"px"),a.css("left",d.left+"px"),a.css("width",d.width+"px"))};
var ra=!1,U=angular.element('<input type="text" style="position:absolute" />');this.labelEditStatus=function(a){if(void 0!=a)ra=a;else return ra};this.getEditBox=function(){return U};this.updateEditBox=function(a){U&&a&&(U.css("top",a.top+"px"),U.css("left",a.left+"px"),U.css("width",a.width+"px"),U.css("height",a.height+"px"))};c.$on(c.name+"-open-editor",function(b,d){a.openEditor(d)});c.$on(c.name+"-close-editor",function(b,d){a.closeEditor(d)});this.updateEditorSettings=function(b){a.options.editorSettings=
b?{activate:f.isFieldAvailable(b.activate,"click")}:{activate:"click"}};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(c.events)&&c.events.afterCollapse&&c.events.afterCollapse({item:a});c.afterCollapse({e:{item:a}})};this.callAfterExpand=function(a){angular.isDefined(c.events)&&c.events.afterExpand&&c.events.afterExpand({item:a});c.afterExpand({e:{item:a}})};this.callAfterEdit=function(a){angular.isDefined(c.events)&&c.events.afterEdit&&c.events.afterEdit({item:a});c.afterEdit({e:{item:a}})};
this.callAfterLabelEdit=function(a){angular.isDefined(c.events)&&c.events.afterLabelEdit&&c.events.afterLabelEdit({item:a});c.afterLabelEdit({e:{item:a}})};this.callAfterSelect=function(a){angular.isDefined(c.events)&&c.events.afterSelect?c.events.afterSelect({item:a}):c.afterSelect({e:{item:a}});angular.isDefined(c.events)&&c.events.selectionChanged?c.events.selectionChanged({item:a}):c.selectionChanged({e:{item:a}})};this.callBeforeCollapse=function(a){return angular.isDefined(c.events)&&c.events.beforeCollapse?
c.events.beforeCollapse({item:a}):c.beforeCollapse({e:{item:a}})};this.callBeforeExpand=function(a){return angular.isDefined(c.events)&&c.events.beforeExpand?c.events.beforeExpand({item:a}):c.beforeExpand({e:{item:a}})};this.callBeforeEdit=function(a){return angular.isDefined(c.events)&&c.events.beforeEdit?c.events.beforeEdit({item:a}):c.beforeEdit({e:{item:a}})};this.callBeforeLabelEdit=function(a){return angular.isDefined(c.events)&&c.events.beforeLabelEdit?c.events.beforeLabelEdit({item:a}):c.beforeLabelEdit({e:{item:a}})};
this.callChange=function(){angular.isDefined(c.events)&&c.events.change?c.events.change():c.change()};this.callDragEnter=function(a){angular.isDefined(c.events)&&c.events.dragEnter?c.events.dragEnter({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):c.dragEnter({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callDragOver=function(a){return angular.isDefined(c.events)&&
c.events.dragOver?c.events.dragOver({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragOver({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){return angular.isDefined(c.events)&&c.events.dragDrop?c.events.dragDrop({event:a.event,
sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragDrop({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragLeave=function(a){angular.isDefined(c.events)&&c.events.dragLeave?c.events.dragLeave({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,
targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):c.dragLeave({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callEnabledChanged=function(a){angular.isDefined(c.events)&&c.events.enabledChanged?c.events.enabledChanged({enabled:a}):c.enabledChanged({e:{enabled:a}})};this.callItemClick=function(a,d,f){angular.isDefined(c.events)&&c.events.itemClick&&c.events.itemClick({event:a,item:d,mousePos:f});
c.itemClick({e:{event:a,item:d,mousePos:f}})};this.callItemDblClick=function(a,d){return angular.isDefined(c.events)&&c.events.itemDblClick?c.events.itemDblClick({item:a,mousePos:d}):c.itemDblclick({e:{item:a,mousePos:d}})};this.callItemHover=function(a){angular.isDefined(c.events)&&c.events.itemHover?c.events.itemHover({item:a}):c.itemHover({e:{item:a}})};this.callItemRightClick=function(a,d){angular.isDefined(c.events)&&c.events.itemRightClick&&c.events.itemRightClick({item:a,mousePos:d});c.itemRightclick({e:{item:a,
mousePos:d}})};this.callKeyDown=function(a,d){angular.isDefined(c.events)&&c.events.keyDown?c.events.keyDown({event:a,item:d}):c.keyDown({e:{event:a,item:d}})};this.callKeyPress=function(a,d){angular.isDefined(c.events)&&c.events.keyPress?c.events.keyPress({event:a,item:d}):c.keyPress({e:{event:a,item:d}})};this.callKeyUp=function(a,d){angular.isDefined(c.events)&&c.events.keyUp?c.events.keyUp({event:a,item:d}):c.keyUp({e:{event:a,item:d}})};this.callScrollPosChanged=function(){angular.isDefined(c.events)&&
c.events.scrollPosChanged?c.events.scrollPosChanged({scrollPos:a.scrollPos}):c.scrollposChanged({e:{scrollPos:a.scrollPos}})};k.bind("click",function(b){a.options.enabled&&1===b.which&&a.callItemClick(b,null,a.getMousePos(b))});k.bind("dblclick",function(b){b.preventDefault();a.options.enabled&&1===b.which&&a.callItemDblClick(null,a.getMousePos(b));b.stopPropagation()});k.bind("mousedown",function(b){a.options.enabled&&3===b.which&&a.callItemRightClick(null,a.getMousePos(b));b.stopPropagation()});
this.expandList=[];this.expandIndentList=[];this.expandParentList=[];var Ea=function(b,d,c,e){b.type="item";b[a.options.dataFields.id]||(b[a.options.dataFields.id]=f.getUniqueId());c&&(b[a.options.dataFields.pid]=c);c=t(b);a.isItemExpanded(b)&&b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&(c=c&&a.isThereVisibleChildren(b));c&&(0!=a.options.showStatusIcons&&(d+=15),a.expandList.push(b),a.expandIndentList.push(d),a.expandParentList.push({parent:e}));return c},y=function(b,d,
c,f){if(!b[a.options.dataFields.items])return c=Ea(b,d+a.options.indent,c,f);if(c=Ea(b,d+a.options.indent,c,f)){f=0;var e;if(a.isItemExpanded(b)){var g=b[a.options.dataFields.items];if(g){a.applySorting(g);for(var h=0;h<g.length;h++)(e=y(g[h],d+a.options.indent,b[a.options.dataFields.id],b))&&f++}}!a.isThereChildItems&&(0<f||!a.isItemExpanded(b)&&b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&a.isThereVisibleChildren(b))&&(a.isThereChildItems=!0)}return c};this.expand=function(b){a.expandList.length=
[];a.expandIndentList.length=[];a.expandParentList.length=[];if(!a.isItemExpanded(b)){var d=a.getItemCurrentIndex(b),c=a.getList(b);if(c){a.applySorting(c);for(var f=0;f<c.length;f++)y(c[f],a.indentList[d],null,b)}if(0<a.expandList.length){a.allowEvents=!1;d++;Array.prototype.splice.apply(a.currentList,[d,0].concat(a.expandList));Array.prototype.splice.apply(a.indentList,[d,0].concat(a.expandIndentList));Array.prototype.splice.apply(a.parentList,[d,0].concat(a.expandParentList));a.getItemScope()?
a.updateView():a.updateLayout();var g=e(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();e.cancel(g);a.allowEvents=!0},1)}}};this.collapse=function(b){a.expandList.length=[];a.expandIndentList.length=[];if(a.isItemExpanded(b)){var d=null,c=!1,f=b,g=-1,h=a.getItemCurrentIndex(b);for(b=a.getParent(b);b&&!c;){d=a.getList(b);for(g=d.indexOf(f)+1;!c&&g<d.length;)f=d[g],0<a.getItemCurrentIndex(f)&&(c=!0),g++;c||(f=b);b=a.getParent(b)}if(!c&&f)for(d=a.getList(),g=d.indexOf(f)+1;g<d.length;)if(f=
d[g],0<a.getItemCurrentIndex(f)){c=!0;break}else g++;h++;d=a.currentList.length-h;c&&(d=a.getItemCurrentIndex(f)-h);if(0<d){a.currentList.splice(h,d);a.indentList.splice(h,d);a.parentList.splice(h,d);a.getItemScope()?a.updateView():a.updateLayout();var k=e(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();e.cancel(k);a.allowEvents=!0},1)}}};this.toggle=function(b,d){if(b){if(b[a.options.dataFields.hasChildren]||b[a.options.dataFields.items]&&0!==b[a.options.dataFields.items].length)if(!d||
!1===b[a.options.dataFields.expanded])if(!1!==d||!1!==b[a.options.dataFields.expanded]){var c=void 0!==d?d:!1!==b[a.options.dataFields.expanded]?!0:!1;!1!==(void 0!==d?d?a.callBeforeExpand(b):a.callBeforeCollapse(b):c?a.callBeforeCollapse(b):a.callBeforeExpand(b))&&(c=void 0!=d?d:!c,c!=b[a.options.dataFields.expanded]&&(0!=c?a.expand(b):a.collapse(b),b[a.options.dataFields.expanded]=c),a.isItemExpanded(b)?a.callAfterExpand(b):a.callAfterCollapse(b))}}else{for(var c=a.getFullList(),f=0;f<c.length;f++)c[f][a.options.dataFields.expanded]=
d;a.updateCurrentLayout()}};c.$on(c.name+"-collapse",function(b,d){a.toggle(d,!1)});c.$on(c.name+"-expand",function(b,d){a.toggle(d,!0)});c.$on(c.name+"-toggle",function(b,d){a.toggle(d)});this.filterParams=null;c.$on(c.name+"-filter",function(b,d){a.filter(d)});this.filter=function(b){a.filterParams=b;a.updateCurrentLayout();a.callChange()};this.callGotFocus=function(a,d,f,e){angular.isDefined(c.events)&&c.events.gotFocus?c.events.gotFocus({event:a,item:d,edit:void 0!=f?!0:!1,editValue:e}):c.gotFocus({e:{event:a,
item:d,edit:void 0!=f?!0:!1,editValue:e}})};this.callLostFocus=function(a,d,f,e){angular.isDefined(c.events)&&c.events.lostFocus?c.events.lostFocus({event:a,item:d,edit:void 0!=f?!0:!1,editValue:e}):c.lostFocus({e:{event:a,item:d,edit:void 0!=f?!0:!1,editValue:e}})};this.getTabIndex=function(){return k[0].attributes&&k[0].attributes.tabindex?k[0].attributes.tabindex.value:""};this.updateFocus=function(b){if(1==a.options.allowFocus)var d=e(function(){if(b){var c=a.getElemFromItem(b);c&&(c=a.getElement(c))&&
c[0].focus()}else k[0].focus();e.cancel(d)},5)};c.$on(c.name+"-focus",function(b,d){a.updateFocus(d)});var ja=!1;this.isItemExpanded=function(b){return b?b[a.options.dataFields.expanded]||void 0===b[a.options.dataFields.expanded]?!0:!1:!0};this.getElement=function(a,d){var c=null;d||(d="content");if(a)for(var f=a.children(),e=0;e<f.length;e++){var g=angular.element(f.eq(e));if(g[0].attributes&&g[0].attributes["data-element"]&&g[0].attributes["data-element"].value===d){c=g;break}}return c};this.getElemFromItem=
function(b){var d=null;if(b){b=a.getItemCurrentIndex(b);var c=k.find("li");if(c&&0<c.length)for(var f=0;f<c.length;f++){var e=angular.element(c[f]);if(e[0].attributes["data-index"]&&e[0].attributes["data-index"].value.toString()===b.toString()){d=e;break}}}return d};this.getIndent=function(b){var d=0;if(b&&0<a.options.indent)for(parent=a.dataObj.getParent(b);parent;)d+=a.options.indent,parent=a.dataObj.getParent(parent);return d};this.getItemCurrentIndex=function(b){return b&&a.currentList?a.currentList.indexOf(b):
-1};this.getObjCurrentIndex=function(b){return a.getItemCurrentIndex(b)};this.getObjState=function(b){if(b)switch(b.type){case "item":if(0==a.options.enabled||0==b[a.options.dataFields.enabled])return"disabled";if(1==b.selected&&a.isObjInSelList(b))return"selected";if(b==a.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(b){return b?(b=angular.element(b))?a.getItemFromElem(b[0].parentElement):null:null};this.getItemFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&
(b=b[0].attributes["data-index"].value,a.isIndexInRange(b)))return a.currentList[b]};this.isIndexInRange=function(b){return 0<=b&&b<a.currentList.length};this.isItemEnabled=function(b){return b&&1==a.options.enabled&&f.isEnabled(b[a.options.dataFields.enabled])};this.mouseButtonStatus=function(a){ja=a};c.$on(c.name+"-ensure-visible",function(b,d,c){a.ensureVisible(d,c)});c.$on(c.name+"-find-item-by-id",function(b,d){g.setTempData(a.findItemById(d))});c.$on(c.name+"-find-item-by-text",function(b,d){g.setTempData(a.findItemByText(d))});
c.$on(c.name+"-get-full-path",function(b,d){g.setTempData(a.getFullPath(d))});c.$on(c.name+"-get-item-level",function(b,d){g.setTempData(a.getLevel(d))});c.$on(c.name+"-get-item-parent",function(b,d){g.setTempData(a.getParent(d))});c.$on(c.name+"-get-item-at",function(b,d){d?g.setTempData(a.getItemAt(d.x,d.y)):g.setTempData(null)});c.$on(c.name+"-get-flat-list",function(b,d){d?g.setTempData(a.getFullList()):g.setTempData(a.currentList)});c.$on(c.name+"-get-list",function(b,d,c){1==c?g.setTempData(a.getFullList(d)):
g.setTempData(a.getList(d))});this.ensureVisible=function(b,d){if(b){for(var c=[],f=a.getParent(b);f;)c.push(f),f=a.getParent(f);for(f=c.length-1;0<=f;f--)c[f][a.options.dataFields.expanded]=!0;a.updateCurrentLayout();var g=e(function(){d=void 0!=d?d:"center";a.scrollTo(b,d);e.cancel(g)},100)}};this.findItemById=function(b){return a.dataObj.findObjectById(b)};this.findItemByText=function(b){return a.dataObj.findObjectByText(b)};this.getFullPath=function(b){var d="";if(b)for(d=b[a.options.dataFields.text],
b=a.getParent(b);b;)d=[b[a.options.dataFields.text],a.options.pathSeparator,d].join(""),b=a.getParent(b);return d};this.getLevel=function(a){var d=0;for(a=this.getParent(a);a;)d++,a=this.getParent(a);return d};this.getParent=function(b){return a.dataObj.getParent(b)};this.getList=function(b){return a.dataObj.getList(b)};this.getFirstItem=function(){for(var b=null,d=0;d<a.currentList.length;d++)if(a.isItemEnabled(a.currentList[d])){b=a.currentList[d];break}return b};this.getPrevItem=function(b){var d=
null;if(0<=b&&b<a.currentList.length)for(--b;0<=b;b--)if(a.isItemEnabled(a.currentList[b])){d=a.currentList[b];break}return d};this.getNextItem=function(b){var d=null;for(b+=1;b<a.currentList.length;b++)if(a.isItemEnabled(a.currentList[b])){d=a.currentList[b];break}return d};this.getLastItem=function(){for(var b=null,d=a.currentList.length-1;0<=d;d--)if(a.isItemEnabled(a.currentList[d])){b=a.currentList[d];break}return b};this.updateSelectionStatus=function(b){switch(b){case "shift":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);
a.shiftKeyStatus(!1);break;case "multi-extended":a.multiSelection(!0);a.shiftKeyStatus(!0);break;default:a.multiSelection(!1),a.shiftKeyStatus(!1)}break;case "ctrl":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}}};k.bind("keydown",function(b){if(a.options.enabled)switch(b.keyCode){case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;default:(b.ctrlKey||
b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}});a.allowUpdate=!0;this.suspendLayout=function(){a.allowUpdate=!1};this.resumeLayout=function(){a.allowUpdate=!0;a.updateLayout()};c.$on(c.name+"-refresh",function(b,d,c){a.refresh(d,c)});c.$on(c.name+"-resume-layout",function(b){a.resumeLayout()});c.$on(c.name+"-suspend-layout",function(b){a.suspendLayout()});c.$on(c.name+"-update-layout",function(b){a.updateLayout()});c.$on(c.name+"-update-view",function(b){a.updateView()});
c.$on(c.name+"-begin-load",function(b,d,c){d?(0>a.options.loadItems.indexOf(d)&&a.options.loadItems.push(d),a.updateView()):a.beginLoad(c)});c.$on(c.name+"-end-load",function(b,d){a.endLoad(d)});this.callLoadComplete=function(){angular.isDefined(c.events)&&c.events.loadComplete?c.events.loadComplete():c.loadComplete()};this.callUpdateComplete=function(){angular.isDefined(c.events)&&c.events.updateComplete?c.events.updateComplete():c.updateComplete()};c.$on(c.name+"-get-scroll-pos",function(b){g.setTempData(a.getScrollPos())});
c.$on(c.name+"-set-scroll-pos",function(b,d){a.setScrollPos(d)});c.$on(c.name+"-scroll-to",function(b,d,c){a.scrollTo(d,c)});var aa=!1,V=!1;this.shiftKeyStatus=function(a){if(void 0!=a)aa=a;else return aa};this.multiSelection=function(a){if(void 0!=a)V=a;else return V};this.isItemSelected=function(a){return f.isSelected(a)};this.clearPrevSelection=function(b){for(var d=0;d<a.options.selectedItems.length;d++)b&&!f.isEqual(a.options.selectedItems[d][a.options.dataFields.id],b[a.options.dataFields.id])?
a.options.selectedItems[d].selected=!1:b||(a.options.selectedItems[d].selected=!1);a.options.selectedItems.length=0;b&&a.isItemEnabled(b)&&a.options.selectedItems.push(b);a.refresh()};this.selectionCancelled=!1;this.itemSelection=function(b,d,e){if(d){if("none"!==a.options.selectionMode)if(a.isItemEnabled(d)){var g=a.itemSelection(),h=!0;g&&(h=!f.isEqual(g[a.options.dataFields.id],d[a.options.dataFields.id]));var k=!0,k=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({item:d}):
c.beforeSelect({e:{item:d}});a.selectionCancelled=0==k;if(0!=k)if(h){var l=b&&(b.shiftKey||b.ctrlKey||b.metaKey)?!0:!1,h=!0;"multi-extended"===a.options.selectionMode&&(h=!a.isObjInSelList(d));h&&("one"==a.options.selectionMode?a.clearPrevSelection():ja&&(aa||b&&b.shiftKey)?a.clearPrevSelection():V||l||"multi-simple"===a.options.selectionMode||a.clearPrevSelection());a.options.selectedItem=d;if(ja&&(aa||b&&b.shiftKey)&&"one"!=a.options.selectionMode){if(b=a.getItemCurrentIndex(g),e=a.getItemCurrentIndex(d),
b>e&&(g=b,b=e,e=g),a.isIndexInRange(b)&&a.isIndexInRange(e))for(;b<=e;b++)a.currentList[b].selected=!0,a.options.selectedItems.push(a.currentList[b])}else ja&&(V||l||"multi-simple"===a.options.selectionMode)?(b=null===d.selected||"undefined"===d.selected?!1:d.selected,d.selected=!b,d.selected?a.isObjInSelList(d)||a.options.selectedItems.push(d):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=d})):(d.selected=!0,a.isObjInSelList(d)||a.options.selectedItems.push(d));angular.isDefined(c.selectedItem)&&
(c.selectedItem=d);a.callAfterSelect(d);a.refresh(null,null,!0)}else if(V||l||"multi-simple"===a.options.selectionMode)b=null===d.selected||"undefined"===d.selected?!1:d.selected,e&&"undefined"!==e&&(b=e),d[a.options.dataFields.selected]=!b,d[a.options.dataFields.selected]?a.isObjInSelList(d)||a.options.selectedItems.push(d):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=d}),a.callAfterSelect(d),a.refresh(null,null,!0)}else a.clearPrevSelection()}else return a.options.selectedItem};
this.updateSelection=function(b,d){var c=b&&(b.shiftKey||b.metaKey)?!0:!1;!("multi-simple"!==a.options.selectionMode&&0<a.options.selectedItems.length)||aa||b.shiftKey||V||c||a.selectionCancelled||(a.clearPrevSelection(d),a.refresh(null,null,!0));a.selectionCancelled=!1};this.selectFirstItem=function(){for(var b=null,d=0;d<a.currentList.length;d++)if(a.isItemEnabled(a.currentList[d])){b=a.currentList[d];break}this.itemSelection(null,b);return a.options.selectedItem};this.isObjInSelList=function(b){var d=
!1,c=a.options.selectedItems;if(b&&c)for(var e=0;e<c.length;e++)if(f.isEqual(c[e][a.options.dataFields.id],b[a.options.dataFields.id])){d=!0;break}return d};this.getItemAt=function(b,d){var c,e,g=null,h=k.find("li");if(h&&0<h.length)for(var l=0;l<h.length;l++)if(c=angular.element(h[l]),e=f.getPageRect(c),f.checkHit(b,d,e)){g=a.getItemFromElem(c);break}return g};this.resetSelection=function(){switch(a.options.selectionMode){case "none":a.clearPrevSelection();break;default:a.clearPrevSelection(a.itemSelection())}};
c.$on(c.name+"-clear-selection",function(b){a.clearPrevSelection();a.options.selectedItem=null});c.$on(c.name+"-get-selected-item",function(b){g.setTempData(a.itemSelection())});c.$on(c.name+"-set-selected-item",function(b,d){var c=e(function(){a.itemSelection(null,d);e.cancel(c)},1)});c.$on(c.name+"-get-selected-items",function(b){g.setTempData(a.options.selectedItems)});c.$on(c.name+"-set-selected-items",function(b,d){d&&Array.isArray(d)&&e(function(){for(var b=a.options.selectedItems.length=0;b<
d.length;b++)d[b].selected=!0,a.options.selectedRows.push(d[b]);0<d.length?(a.options.selectedItem=d[d.length-1],a.callAfterSelect(a.options.selectedItem)):a.options.selectedItem=null;a.refresh(null,null,!0)},1)});c.$on(c.name+"-move-item",function(b,d,c,f,e){a.moveItem(d,c,f,e)});c.$watch("options",function(b,d){b!==d&&(a.updateOptions(b),a.updateLayout())},!0);c.$watch("allowDrag",function(b,d){b!==d&&(a.options.allowDrag=b,a.updateView())});c.$watch("allowDrop",function(b,d){b!==d&&(a.options.allowDrop=
b,a.updateView())});c.$watch("allowFocus",function(b,d){b!==d&&(a.options.allowFocus=b)});c.$watch("autoCheck",function(b,d){b!==d&&(a.options.autoCheck=b,a.updateView())});c.$watch("autoExpand",function(b,d){b!==d&&(a.options.autoExpand=b)});c.$watch("checkBoxSettings",function(b,d){b!==d&&a.updateCheckBoxSettings(b)});c.$watch("controlStyle",function(b,d){b!==d&&a.updateControlStyle(b)});c.$watch("editorSettings",function(b,d){b!==d&&a.updateEditorSettings(b)});c.$watch("enabled",function(b,d){b!==
d&&(a.options.enabled=b,a.updateView(),a.callEnabledChanged(b))});c.$watch("fields",function(b,d){b!==d&&(a.options.dataFields=b,a.UpdateData())});c.$watch("hoverSelection",function(b,d){b!==d&&(a.options.hoverSelection=b)});c.$watch("indent",function(b,d){b!==d&&(a.options.indent=b,a.updateLayout())});c.$watch("itemIcon",function(b,d){b!==d&&(a.options.itemIcon=b,a.updateLayout())});c.$watch("labelEdit",function(b,d){b!==d&&(a.options.labelEdit=b)});c.$watch("pathSeparator",function(b,d){b!==d&&
(a.options.pathSeparator=b)});c.$watch("rtl",function(b,d){b!==d&&(a.options.rtl=b,a.updateLayout())});c.$watch("selectionMode",function(b,d){b!==d&&(a.options.selectionMode=b,a.resetSelection())});c.$watch("showCheckBoxes",function(b,d){b!==d&&(a.options.showCheckBoxes=b,a.updateLayout())});c.$watch("showExpandBoxes",function(b,d){b!==d&&(a.options.showExpandBoxes=b,a.updateLayout())});c.$watch("showIcons",function(b,d){b!==d&&(a.options.showIcons=b,a.updateLayout())});c.$watch("showLines",function(b,
d){b!==d&&(a.options.showLines=b,a.updateLayout())});c.$watch("showStatusIcons",function(b,d){b!==d&&(a.options.showStatusIcons=b,a.updateLayout())});c.$watch("selectedItem",function(b,d){b!==d&&(d&&(d.selected=!1),a.options.selectedItem=b,a.callAfterSelect(b))});c.$watch("templateSettings",function(b,d){b!==d&&(a.updateTemplateSettings(b),a.updateLayout())});this.sortComparer=null;c.$watch("sorting",function(b,d){b!==d&&(a.options.sorting=b)});c.$on(c.name+"-sort",function(b,d,c){a.sort(d,c)});this.sort=
function(b,d){a.sortComparer=d;if("ascending"==b||"descending"==b||"none"==b)a.options.sorting=b;a.updateCurrentLayout();a.callChange()};this.isSortingAllowed=function(){return"ascending"==a.options.sorting||"descending"==a.options.sorting};this.applySorting=function(b){b&&(a.sortComparer?b.sort(a.sortComparer):a.isSortingAllowed()&&b.sort(function(b,c){var e,g;(e=b[a.options.dataFields.value])||(e=b[a.options.dataFields.text]);f.isObject(e)&&(e=e.value?e.value:e.text);(g=c[a.options.dataFields.value])||
(g=c[a.options.dataFields.text]);f.isObject(g)&&(g=g.value?g.value:g.text);e=void 0!=e?e:null;g=void 0!=g?g:null;switch(a.options.sorting){case "ascending":if(e<g)return-1;if(e>g)return 1;break;case "descending":if(e>g)return-1;if(e<g)return 1;break;default:return 0}}))};var Ra=function(b){if(b){var d=f.isFieldAvailable(b.general,"iui-checkbox");b=(b=b.box)?{general:f.isFieldAvailable(b.general,"iui-checkbox-box"),disabled:f.isFieldAvailable(b.disabled,"iui-checkbox-disabled"),checked:f.isFieldAvailable(b.checked,
"iui-checkbox-checked"),indeterminate:f.isFieldAvailable(b.indeterminate,"iui-checkbox-indeterminate"),unchecked:f.isFieldAvailable(b.unchecked,"iui-checkbox-unchecked")}:a.options.controlStyle.item.checkBox.box;return{general:d,box:b}}return a.options.controlStyle.item.checkBox};this.getExpandBoxStyle=function(b){return b?{general:f.isFieldAvailable(b.general,"iui-treeview-expand-box"),animated:f.isFieldAvailable(b.animated,"iui-treeview-expand-box-load"),expanded:f.isFieldAvailable(b.expanded,"iui-treeview-expand-box-open"),
collapsed:f.isFieldAvailable(b.collapsed,"iui-treeview-expand-box-close")}:a.options.controlStyle.item.expandBox};var Sa=function(b){if(b){var d;d=b.general;d=f.isString(d)?d:d?{disabled:f.isFieldAvailable(d.disabled,"iui-treeview-item-disabled"),focused:f.isFieldAvailable(d.focused,"iui-treeview-item-focused"),normal:f.isFieldAvailable(d.normal,"iui-treeview-item"),hovered:f.isFieldAvailable(d.hovered,"iui-treeview-item-hovered"),selected:f.isFieldAvailable(d.selected,"iui-treeview-item-selected")}:
a.options.controlStyle.item.general;var c=Ra(b.checkBox),e=a.getExpandBoxStyle(b.expandBox);b=b.content;b=f.isString(b)?b:b?{disabled:f.isFieldAvailable(b.disabled,"iui-treeview-item-content-disabled"),focused:f.isFieldAvailable(b.focused,"iui-treeview-item-content-focused"),normal:f.isFieldAvailable(b.normal,"iui-treeview-item-content"),hovered:f.isFieldAvailable(b.hovered,"iui-treeview-item-content-hovered"),selected:f.isFieldAvailable(b.selected,"iui-treeview-item-content-selected")}:a.options.controlStyle.item.content;
return{general:d,checkBox:c,expandBox:e,content:b}}return a.options.controlStyle.item};this.updateControlStyle=function(b){a.options.controlStyle=b?{general:f.isFieldAvailable(b.general,"iui-treeview"),item:Sa(b.item)}:{general:f.isFieldAvailable(a.defaultStyle.general,"iui-treeview"),item:Sa(a.defaultStyle.item)}};this.getCurrentItemStyle=function(b,d){var c=a.options.controlStyle.item;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemStyle(a.getParent(b),d);default:null!=
b.style&&(c=b.style)}if(d){if(f.isString(c.general))return c.general;switch(d){case "disabled":return c.general&&c.general.disabled?c.general.disabled:a.options.controlStyle.item.general.disabled;case "focused":return c.general&&c.general.focused?c.general.focused:a.options.controlStyle.item.general.focused;case "hovered":return c.general&&c.general.hovered?c.general.hovered:a.options.controlStyle.item.general.hovered;case "selected":return c.general&&c.general.selected?c.general.selected:a.options.controlStyle.item.general.selected;
default:return c.general&&c.general.normal?c.general.normal:a.options.controlStyle.item.general.normal}}else return c?c:a.options.controlStyle.item};this.getCurrentItemContentStyle=function(b,c){var e=a.options.controlStyle.item.content;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemContentStyle(a.getParent(b),c);default:null!=b.style&&b.style.content&&(e=b.style.content)}if(c){if(f.isString(e))return e;switch(c){case "disabled":return e&&e.disabled?e.disabled:a.options.controlStyle.item.content.disabled;
case "focused":return e&&e.focused?e.focused:a.options.controlStyle.item.content.focused;case "hovered":return e&&e.hovered?e.hovered:a.options.controlStyle.item.content.hovered;case "selected":return e&&e.selected?e.selected:a.options.controlStyle.item.content.selected;default:return e&&e.normal?e.normal:a.options.controlStyle.item.content.normal}}else return e?e:a.options.controlStyle.item.content}}]).directive("iuiTreeview",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop",
"$window",function(c,k,e,h,f,J){return{restrict:"EA",controller:"IntegralUITreeViewController",transclude:!0,replace:!0,template:'<div class="iui-treeview" data-element="treeview"><ul class="iui-treeview-block"></ul></div>',scope:{allowAnimation:"=",allowDrag:"=",allowDrop:"=",allowFocus:"=",animationSpeed:"=",autoCheck:"=",autoExpand:"=",checkboxSettings:"=",controlStyle:"=",editorSettings:"=",enabled:"=",fields:"=",hoverSelection:"=",itemIcon:"=",indent:"=",items:"=",labelEdit:"=",name:"@",options:"=?",
pathSeparator:"@",rtl:"=",selectedIndex:"=",selectedItem:"=",selectionMode:"@",showCheckBoxes:"=",showExpandBoxes:"=",showIcons:"=",showLines:"=",showStatusIcons:"=",sorting:"@",templateSettings:"=",afterCollapse:"&",afterEdit:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeEdit:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",change:"&",clear:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",enabledChanged:"&",events:"=?",itemAdded:"&",itemAdding:"&",
itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",loadComplete:"&",gotFocus:"&",keyDown:"&",keyPress:"&",keyUp:"&",lostFocus:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&",updateComplete:"&"},link:function(g,l,Qa,a,L){var I=this,w=l.children().eq(0),t=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),
q=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),M=angular.element('<div class="iui-scrollbar-corner"></div>'),Q=null,T=null,ia=null,u=a.getEditBox(),Da=function(){var b="iui-treeview-block";a.options.rtl&&(b+=" "+b+"-rtl");return b};g.$on("$destroy",function(a){W&&(k.cancel(W),W=null);l.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll touchstart touchmove touchend");
angular.element(J).unbind("dragenter dragover dragend mousemove mouseup");u&&u.unbind("blur focus keydown mousedown");V();m&&m.$destroy()});l.append(a.getDropMarkWindow());a.dropMark();var ra=function(){Q&&(k.cancel(Q),Q=null)};a.addDropMark=function(){var b;b=l[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};var U=function(b,
c){a.labelEditStatus()&&a.closeEditor();b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var A=a.getItemFromChildElem(c);if(A){var d=c[0].getBoundingClientRect(),D=cb(),e=a.getMousePos(b);e.x-=d.left+D.x;e.y-=d.top+D.y;var D=f.getDropPos(e,{x:0,y:0,width:c[0].offsetWidth,height:c[0].offsetHeight}),e=f.getData(),d=a.isDropAllowed(e.source,A,D),g=
{event:b,sourceTree:e.sourceCtrl?e.sourceCtrl.getCtrlName():"",dragItem:e.source,targetTree:a.getCtrlName(),targetItem:A,isDropAllowed:d,dropPos:D,mousePos:a.getMousePos(b)},g=a.callDragOver(g);if(d&&0!=g){var h=a.getMousePos(b),g=h.y+16,h=h.x+20,k=a.getDropMarkWindow();k.empty();var l="iui-drop-marker-move-in";switch(D){case 1:l="iui-drop-marker-move-up";break;case 2:l="iui-drop-marker-move-down"}k.append("<span class='"+l+"'></span><span class='iui-drop-marker-title'>"+A[a.options.dataFields.text]+
"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:g,left:h});a.dropMark(d);f.setData({source:e.source,sourceList:e.sourceList,target:A,dropPos:D})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}},Ea=function(b,c){b.preventDefault();ra();a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===
b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var A=a.getItemFromChildElem(c);if(A){var D=f.getData(),e=D.source;e||(e=a.getDnDSource(b));(d=a.isDropAllowed(e,A,D.dropPos))&&e&&(d={event:b,sourceTree:D.sourceCtrl?D.sourceCtrl.getCtrlName():"",dragItem:e,targetTree:a.getCtrlName(),targetItem:A,isDropAllowed:d,dropPos:D.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(d)&&(a.drop(D),g.$$phase||g.$apply()))}}f.clearData();a.dragDropStatus(!1);b.stopPropagation()},y=angular.element('<div style="opacity:0.75;position:absolute;z-index:999"></div>'),
ja=function(){y&&(y.remove(),y.css("top","-9999999px"),y.css("left","-9999999px"))},aa=function(b){var c="";if(a.options.showExpandBoxes){var d=a.defaultStyle.item.expandBox.general;b[a.options.dataFields.style]&&b[a.options.dataFields.style].expandBox&&b[a.options.dataFields.style].expandBox.general!=d?d+=" "+b[a.options.dataFields.style].expandBox.general:a.options.controlStyle.item.expandBox.general!=d&&(d+=" "+a.options.controlStyle.item.expandBox.general);var A=a.getCurrentItemStyle(b),A=a.getExpandBoxStyle(A.expandBox);
if(a.isThereChildItems||b&&b[a.options.dataFields.hasChildren])c=d;b&&(b[a.options.dataFields.hasChildren]||b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&a.isThereVisibleChildren(b))&&(0<=a.options.loadItems.indexOf(b)?c+=" "+A.animated:(c=b[a.options.dataFields.hasChildren]&&void 0===b[a.options.dataFields.expanded]?c+(" "+A.expanded):0!=b[a.options.dataFields.expanded]?c+(" "+A.collapsed):c+(" "+A.expanded),!0===a.options.rtl&&(c+="-rtl"),a.options.enabled&&a.isItemEnabled(b)||
(c+="-disabled")))}return c},V=function(){var b=w.find("li");if(0<b.length)for(var c=0;c<b.length;c++){currentElem=angular.element(b[c]);currentElem.unbind("dragover drop dragenter dragleave dragend");var d=a.getElement(currentElem,"expandbox");d&&d.unbind("click touchend");(d=a.getElement(currentElem))&&d.unbind("blur click dragstart dragover drop dragenter dragleave dragend dblclick focus keydown keypress keyup mouseenter mouseleave mousedown mouseup touchstart touchmove touchend")}},Ra=function(){var c=
w.find("li");if(0<c.length){var f,e=c.length-1,A="content";a.getTemplateUrl()&&(A="template-content");for(var D=0;D<=e;D++)f=angular.element(c[D]),Sa(f),b(a.getElement(f,"expandbox")),d(a.getElement(f,"icon")),yb(a.getElement(f,A))}},Sa=function(b){b&&(b.bind("dragover",function(b){var c=a.getItemFromElem(this);if(c&&a.isItemEnabled(c)){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=l[0].getBoundingClientRect();c.x-=angular.element(J)[0].pageXOffset;c.y-=angular.element(J)[0].pageYOffset;
c.y<d.top+40?Ta(b,!1):c.y>d.bottom-40?Ta(b,!0):ka()}else ka();b.stopPropagation()}}),b.bind("dragend",function(b){var c=a.getItemFromElem(this);c&&a.isItemEnabled(c)&&(b.preventDefault(),a.dragDropStatus(!1),a.dropMark(),f.getData().source||f.clearData())}))},b=function(b){b&&(b.bind("click",function(b){var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&(a.toggle(c),b.stopPropagation())}),b.bind("touchend",function(b){b.preventDefault();var c=angular.element(this);(c=a.getItemFromChildElem(c))&&
a.isItemEnabled(c)&&(a.toggle(c),b.stopPropagation())}))},d=function(b){b&&(b.bind("dragover",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&U(b,angular.element(this))}),b.bind("drop",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&Ea(b,angular.element(this))}))};a.dragIcon=document.createElement("img");a.dragIcon.width=1;var r={x:0,y:0},p={x:0,y:0},pa=!1,bb=!1,Z=null,cb=function(){return{x:angular.element(J)[0].pageXOffset,y:angular.element(J)[0].pageYOffset}},
qa=function(a){var b=cb();return{x:a.x-b.x,y:a.y-b.y}},yb=function(b){if(b){b.bind("dragstart",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c))if(c=angular.element(this),a.labelEditStatus())b.preventDefault();else{f.clearData();if(c=a.getItemFromChildElem(c))if(Ua(),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():"")):b.originalEvent&&
b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():""));c={source:c,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":c.source=a.options.selectedItems;break;case "multi-extended":c.source=a.options.selectedItems}f.setData(c)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&
(b.originalEvent.dataTransfer.effectAllowed="none");b.stopPropagation()}});b.bind("dragover",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&U(b,angular.element(this))});b.bind("drop",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&Ea(b,angular.element(this))});b.bind("dragenter",function(b){b.preventDefault();var c=angular.element(this),d=a.getItemFromChildElem(c);if(d&&a.isItemEnabled(d)&&(Fa||(a.hoverItem=d,a.refresh(d)),a.options.autoExpand))var n=k(function(){Q||
(Q=k(function(){Q&&a.toggle(d,!0)},750));k.cancel(n)},1);c=f.getData();c.source||(c.source=a.getDnDSource(b));c={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(c);b.stopPropagation()});b.bind("dragleave",function(b){b.preventDefault();a.hoverItem=null;var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&a.refresh(c);ra();c=f.getData();c.source||(c.source=
a.getDnDSource(b));c={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(c);b.stopPropagation()});b.bind("dragend",function(b){(b=a.getItemFromChildElem(this))&&a.isItemEnabled(b)&&a.dragDropStatus(!1)});b.bind("touchstart",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)&&(b.preventDefault(),(c=a.getTouchData(b))&&0<c.length)){bb=!0;var d=k(function(){bb=!1;
k.cancel(d)},750);r=qa({x:c[0].pageX,y:c[0].pageY});a.mouseButtonStatus(!0);c=r;if((c=a.getItemAt(c.x,c.y))&&a.isItemEnabled(c)){var n=angular.element(this);a.itemSelection(b,c);Z=c;n[0].focus();a.changeCheckValue(c);"click"==a.options.editorSettings.activate&&Ca(b,angular.element(this))}}});b.bind("touchmove",function(b){var c,d,n=a.getItemFromChildElem(this);if(n&&a.isItemEnabled(n)&&(n=a.getTouchData(b))&&0<n.length){p=qa({x:n[0].pageX,y:n[0].pageY});var n=Math.abs(p.x-r.x),e=Math.abs(p.y-r.y),
N=l[0].getBoundingClientRect();if(f.hitTest(p.x,p.y,N)){if(b.preventDefault(),y&&y.css("display","block"),!bb)if(!pa&&(2<n||2<e)&&Z&&a.isItemEnabled(Z))if(angular.element(this),a.labelEditStatus())b.preventDefault();else{pa=!0;f.clearData();if((n=a.getTouchData(b))&&0<n.length&&(qa({x:n[0].pageX,y:n[0].pageY}),Z&&(Ua(),a.isDragAllowed(Z)))){a.dragDropStatus(!0);a.addDropMark();n={source:Z,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":n.source=a.options.selectedItems;
break;case "multi-extended":n.source=a.options.selectedItems}f.setData(n);if(n=a.getElemFromItem(Z))if(n=a.getElement(n))y.empty(),y.append(n.clone()),y.css("display","none"),l.append(y)}b.stopPropagation()}else if(pa){angular.element(this);a.labelEditStatus()&&a.closeEditor();b.preventDefault();if((n=a.getTouchData(b))&&0<n.length){var N=cb(),H=qa({x:n[0].pageX,y:n[0].pageY});if(n=a.getItemAt(H.x,H.y)){if(e=a.getElemFromItem(n)){var h=e[0].getBoundingClientRect(),h=f.getDropPos({x:H.x-h.left,y:H.y-
h.top},{x:0,y:0,width:e[0].offsetWidth,height:e[0].offsetHeight}),e=f.getData(),k=a.isDropAllowed(e.source,n,h),m={event:b,sourceTree:e.sourceCtrl?e.sourceCtrl.getCtrlName():"",dragItem:e.source,targetTree:a.getCtrlName(),targetItem:n,isDropAllowed:k,dropPos:h,mousePos:H},m=a.callDragOver(m);d=l[0].getBoundingClientRect();c=H.x-d.left;d=H.y-d.top;y.css("top",d-16+"px");y.css("left",c+"px");y.css("display","block");if(k&&0!=m){c=H;H=c.y+N.y+16;N=c.x+N.x+20;c=a.getDropMarkWindow();c.empty();d="iui-drop-marker-move-in";
switch(h){case 1:d="iui-drop-marker-move-up";break;case 2:d="iui-drop-marker-move-down"}c.append("<span class='"+d+"'></span><span class='iui-drop-marker-title'>"+n[a.options.dataFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:H,left:N});a.dropMark(k);f.setData({source:e.source,sourceList:e.sourceList,target:n,dropPos:h})}else a.dropMark()}}else n=f.getData(),e={source:n.source,sourceCtrl:n.sourceCtrl,target:null,dropPos:-1},f.setData(e),m={event:b,sourceTree:n.sourceCtrl?
n.sourceCtrl.getCtrlName():"",dragItem:n.source,targetTree:a.getCtrlName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:H},d=l[0].getBoundingClientRect(),c=H.x-d.left,d=H.y-d.top,y.css("top",d-16+"px"),y.css("left",c+"px"),m=a.callDragOver(m),0==m?a.dropMark():(c=H,H=c.y+16,N=c.x+20,c=a.getDropMarkWindow(),c.empty(),c.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(g.name?g.name:"TreeView")+"</span>"),a.updateDropMarkElem(a.getDropMarkWindow(),
{top:H,left:N}),a.dropMark(!0))}b.stopPropagation()}}else b.preventDefault(),a.dropMark(),a.cancelScrollTimer(),y&&y.css("display","none")}});b.bind("touchend",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)){if((c=a.getTouchData(b))&&0<c.length){var c=qa({x:c[0].pageX,y:c[0].pageY}),d=l[0].getBoundingClientRect();if(f.hitTest(c.x,c.y,d))if(pa){angular.element(this);b.preventDefault();ra();a.dropMark();ja();if((c=a.getTouchData(b))&&0<c.length){var d=qa({x:c[0].pageX,y:c[0].pageY}),
n=a.getItemAt(d.x,d.y);if(n){var c=f.getData(),e=c.source,N=a.isDropAllowed(e,n,c.dropPos);N&&e&&(d={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:e,targetTree:a.getCtrlName(),targetItem:n,isDropAllowed:N,dropPos:c.dropPos,mousePos:d},d=a.callDragDrop(d),!1!==d&&(a.drop(c),g.$$phase||g.$apply()))}else c=f.getData(),c.source&&(d={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:null,isDropAllowed:a.options.allowDrop,
dropPos:-1,mousePos:d},d=a.callDragDrop(d),!1!==d&&(a.drop(c),g.$$phase||g.$apply())),f.clearData()}f.clearData();a.dragDropStatus(!1);b.stopPropagation()}else a.mouseButtonStatus(!1),(c=a.getItemAt(c.x,c.y))&&a.updateSelection(b,c),Ua()}c=pa;a.removeDropMark();ja();p={x:0,y:0};pa=!1;Z=null;c&&b.stopPropagation()}});b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromChildElem(this);if(c){var d="dblclick"==a.options.editorSettings.activate;d&&Ca(b,angular.element(this),
0);0==a.callItemDblClick(c,a.getMousePos(b))||d||a.toggle(c)}}b.stopPropagation()});b.bind("mouseenter",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&(angular.element(this),a.hoverItem=c,a.refresh(c),a.callItemHover(c),a.options.hoverSelection&&(ia=k(function(){ia&&a.itemSelection(b,c)},500)))});b.bind("mouseleave",function(b){a.hoverItem=null;(b=a.getItemFromChildElem(this))&&a.isItemEnabled(b)&&a.refresh(b);ia&&(k.cancel(ia),ia=null)});var c=function(b,c){b.preventDefault();
focusDelayTime=0;var d=a.getItemCurrentIndex(c),n=E+ba-2,n=n<a.currentList.length-1?n:a.currentList.length-1;d===n&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(l[0].clientHeight/4)}),focusDelayTime=1);var e=a.getNextItem(d);if(e){a.itemSelection(b,e);g.$apply();var f=k(function(){a.updateFocus(e);k.cancel(f)},focusDelayTime)}},d=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),n=E;d===(0<n?n:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(l[0].clientHeight/
4)}),focusDelayTime=1);var e=a.getPrevItem(a.getItemCurrentIndex(c));if(e){a.itemSelection(b,e);g.$apply();var f=k(function(){a.updateFocus(e);k.cancel(f)},focusDelayTime)}};b.bind("keydown",function(e){var f=a.getItemFromChildElem(this);if(f&&a.isItemEnabled(f)){a.callKeyDown(e,f);var K=0;switch(e.keyCode){case 9:K=a.currentList.length;0<K&&(e.shiftKey?h.isEqual(f[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||d(e,f):h.isEqual(f[a.options.dataFields.id],a.currentList[K-1][a.options.dataFields.id])||
c(e,f));break;case 13:Ca(e,b,0);break;case 16:a.updateSelectionStatus(e,"shift");break;case 17:a.updateSelectionStatus(e,"ctrl");break;case 33:e.preventDefault();K=a.getItemCurrentIndex(f);f=K-ba;f=0<f?f:0;if(f!==K){var K=1,l=a.getPrevItem(f+1);if(l){a.scrollTo(l);a.itemSelection(e,l);g.$apply();var m=k(function(){a.updateFocus(l);k.cancel(m)},K)}}break;case 34:e.preventDefault();K=a.getItemCurrentIndex(f);f=K+ba;f=f<a.currentList.length-1?f:a.currentList.length-1;f!==K&&(K=1,l=a.getNextItem(f-1))&&
(a.scrollTo(l,"bottom"),a.itemSelection(e,l),g.$apply(),m=k(function(){a.updateFocus(l);k.cancel(m)},K));break;case 35:e.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:B.y});var p=a.getLastItem();p&&(a.itemSelection(e,p),m=k(function(){a.updateFocus(p);k.cancel(m)},1));break;case 36:e.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var q=a.getFirstItem();q&&(a.itemSelection(e,q),m=k(function(){a.updateFocus(q);k.cancel(m)},1));break;case 37:e.preventDefault();f[a.options.dataFields.items]&&
0<f[a.options.dataFields.items].length&&(a.toggle(f,!1),a.updateFocus(f));break;case 32:e.preventDefault();a.itemSelection(e,f,f.selected);g.$apply();break;case 38:d(e,f);break;case 39:e.preventDefault();f[a.options.dataFields.items]&&0<f[a.options.dataFields.items].length&&(a.toggle(f,!0),a.updateFocus(f));break;case 40:c(e,f);break;default:(e.ctrlKey||e.metaKey)&&a.updateSelectionStatus(e,"ctrl"),e.shiftKey&&a.updateSelectionStatus(e,"shift")}}});b.bind("keyup",function(b){var c=a.getItemFromChildElem(this);
if(c&&a.isItemEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}a.callKeyUp(b,c)}});b.bind("keypress",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callKeyPress(b,c)});b.bind("click",function(b){if(1===b.which){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callItemClick(b,c,a.getMousePos(b))}b.stopPropagation()});
b.bind("mousedown",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)){a.mouseButtonStatus(!0);a.itemSelection(b,c);switch(b.which){case 1:a.changeCheckValue(c);"click"==a.options.editorSettings.activate&&Ca(b,angular.element(this));break;case 3:a.callItemRightClick(c,a.getMousePos(b))}b.stopPropagation()}});b.bind("mouseup",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&(a.mouseButtonStatus(!1),a.updateSelection(b,c),1===b.which&&Ua())});b.bind("focus",
function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callGotFocus(b,c)});b.bind("blur",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callLostFocus(b,c)})}};a.openEditor=function(b){if(b){var c=a.getElemFromItem(b);c&&0!=b[a.options.dataFields.allowEdit]&&(b=a.getElement(c))&&Ca(null,b,0)}};a.closeEditor=function(b){b?(b=a.getElemFromItem(b))&&(b=a.getElement(b))&&sa(null,b,!1):sa(null,null,!1)};var Ca=function(b,c,d){a.options.labelEdit&&(void 0===d&&(d=
500),T=k(function(){if(T)var a=k(function(){sa(b,c,!0);k.cancel(a)},d);k.cancel(T)},d/3))},Ua=function(){T&&(k.cancel(T),T=null)},ta=null,sa=function(b,c,d){if(a.dragDropStatus())d=u[0].value,a.labelEditStatus(!1),u.unbind("blur focus keydown mousedown"),u.remove(),ta=null;else{var e=a.getItemFromChildElem(c);if(e)if(c&&e[a.options.dataFields.text]&&""!=e[a.options.dataFields.text]&&c.css("height","auto"),d){if(d="",0!=a.callBeforeLabelEdit(e)){ta=e;a.labelEditStatus(!0);u.unbind("blur focus keydown mousedown");
l.append(u);e[a.options.dataFields.text]&&""!=e[a.options.dataFields.text]||(b=h.getMargin(c[0].parentElement),d=h.getPadding(c[0]),c.css("height",v-(b.top+b.bottom+2)-(d.top+d.bottom)+"px"));d=l[0].getBoundingClientRect();var f=c[0].getBoundingClientRect();b=c[0].offsetHeight-4;d=f.top-d.top-1;var f=a.scrollPos.x+c[0].offsetLeft,g=l[0].clientWidth-c[0].offsetLeft-6;z&&(g-=16);a.updateEditBox({top:d,left:f,width:g,height:b});u[0].value=e[a.options.dataFields.text];u.bind("keydown",function(b){switch(b.keyCode){case 13:e[a.options.dataFields.text]=
u[0].value?u[0].value:"null";sa(b,c,!1);break;case 27:sa(b,c,!1)}b.stopPropagation()});u.bind("focus",function(b){var c=angular.element(this);a.callGotFocus(b,ta,!0,c[0].value)});u.bind("blur",function(a){sa(a)});u.bind("mousedown",function(a){a.stopPropagation()});var m=k(function(){u[0].focus();u[0].select();k.cancel(m)},10)}}else d=u[0].value,a.labelEditStatus(!1),u.unbind("blur focus keydown mousedown"),u.remove(),a.updateView(),a.updateFocus(e),a.callAfterLabelEdit(e),a.callLostFocus(b,e,!0,
d),ta=null;else d=u[0].value,a.labelEditStatus(!1),u.unbind("blur focus keydown mousedown"),u.remove(),a.callAfterLabelEdit(),a.updateView(),a.callLostFocus(b,ta,!0,d),ta=null}},hb=function(b){var c="";b[a.options.dataFields.icon]?c=b[a.options.dataFields.icon]:a.options.itemIcon&&(c=a.options.itemIcon);return c},ib=function(b){return"iui-treeview-status-icon "+b[a.options.dataFields.statusIcon]},jb=function(b){return b?b[a.options.dataFields.icon]||a.options.itemIcon:!1},E=0,m=null,x=100,v=0,X=0,
ba=0,O=0,la=0,Ga=!1,ua=!1,Ha=9,Ia=9,Va=0,ca=0,ma=0,Ja=1,Wa=0,Ka=0,da=0,va=0,Xa=1,F=null,G=null,C=!1,z=!1;this.scrollMousePos=null;var B={x:0,y:0},Ka=0;g.verScrollVisibility=!1;g.$watch("verScrollVisibility",function(b,c){b!=c&&a.updateCurrentLayout()});a.updateViewSize=function(){var b=k(function(){X=0;z=C=!1;a.getTemplateUrl()||a.updateLongestItem();if(!a.getTemplateUrl()&&a.longestItem&&0<a.currentList.length){var c=a.getItemCurrentIndex(a.longestItem),c=angular.element(zb(c,!0));l.append(c);X=
c[0].offsetWidth;var d=l[0].offsetWidth-6;z&&t&&(d-=t[0].offsetWidth);X>d&&(q.unbind("click mousedown"),l.append(q),q.bind("click",function(a){a.stopPropagation()}),q.bind("mousedown",function(b){if(a.options.enabled){b=h.getClientMousePos(b,this);var c=Math.floor(l[0].clientWidth);F&&(b.x<F[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>F[0].offsetLeft+F[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}}),F=angular.element(q.children().eq(0)),C=!0,F.bind("mousedown",
function(b){a.options.enabled&&1===b.which&&(I.scrollMousePos=a.getMousePos(b),Ga=!0);b.stopPropagation()}));c.remove()}g.verScrollVisibility=!1;0<a.currentList.length&&(c=l[0].offsetHeight-6,C&&q&&(c-=q[0].offsetHeight),d=(wa.top+wa.bottom)/2,x=0<v?Math.floor(c/(v+d))+1:100,x<a.currentList.length+1&&(t.unbind("click mousedown mouseup"),l.append(t),t.bind("click",function(a){a.stopPropagation()}),t.bind("mousedown",function(b){if(a.options.enabled&&1==b.which){var c=h.getClientMousePos(b,this),d=
Math.floor(l[0].clientHeight);G&&(c.y<G[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-d}),Ta(b,!1,d)):c.y>G[0].offsetTop+G[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+d}),Ta(b,!0,d)))}}),t.bind("mouseup",function(b){a.cancelScrollTimer()}),G=angular.element(t.children().eq(0)),z=!0,G.bind("mousedown",function(b){a.options.enabled&&1===b.which&&(I.scrollMousePos=a.getMousePos(b),ua=!0);b.stopPropagation()})));C||(q.unbind("mousedown"),q.remove(),B.x=0);z||(t.unbind("mousedown"),
t.remove(),B.y=0);C&&z?l.append(M):M.remove();k.cancel(b);!C&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!z&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};a.updateScrollView=function(){kb()};var kb=function(){var b=k(function(){O=l[0].offsetWidth-6;la=l[0].offsetHeight-6;la=C?la-q[0].offsetHeight:la-4;O=z?O-t[0].offsetWidth:O-4;O<X?w.css("width",X+"px"):w.css("width",O+"px");w.css("height",la+"px");C&&(q.css("bottom","0px"),z||(O+=3),q.css("width",O+1+"px"));z&&(t.css("top",
"0px"),C||(la+=3),t.css("height",la+1+"px"));C&&z&&M.css("bottom","0px");!1!==a.options.rtl?(w.css("left","auto"),w.css("right","-"+(a.scrollPos.x-2).toString()+"px"),C&&(q.css("left","auto"),q.css("right","0px")),z&&(t.css("left","0px"),t.css("right","auto")),C&&z&&(M.css("left","0px"),M.css("right","auto"))):(w.css("left","-"+(a.scrollPos.x-2).toString()+"px"),w.css("right","auto"),C&&(q.css("left","0px"),q.css("right","auto")),z&&(t.css("left","auto"),t.css("right","0px")),C&&z&&(M.css("left",
"auto"),M.css("right","0px")));var c=k(function(){C&&O<X&&(Va=0,ca=2,ma=q[0].clientWidth-4,ma>ca&&(Va=ma-ca),Ha=Math.floor(Va*(O-4)/X),9>Ha&&(Ha=9),F.css("width",Ha+"px"),B.x=X-O,0>B.x&&(B.x=0),Ja=B.x/(Va-Ha-2));var b=a.currentList.length+1;z&&0<a.currentList.length&&x<b&&(da=2,va=t[0].clientHeight-4,Wa=0,va>da&&(Wa=va-da),Ia=Math.floor(Wa*x/b),9>Ia&&(Ia=9),G.css("height",Ia+"px"),Xa=(b-x+1)/(Wa-Ia-2),B.y=Math.floor((b-x+1)*v),0>B.y&&(B.y=0),0==E?G.css("top",da+"px"):E+x-1==a.currentList.length&&
G.css("top",va-G[0].offsetHeight+"px"));k.cancel(c)},1);k.cancel(b)},5)},lb=5,Ya=0,na=0,Za=0,mb=0,oa=!1,$a=!1,xa="none",La="normal",Ma=0,db=null,P=!1,ea=!1,fa=angular.element('<ul class="iui-treeview-block" style="position:absolute;top:-9999999px"></ul>');a.updateActive=!1;a.updateStatus=0;var nb=function(b){var c=e(function(){b?na++:na--;Za=(l[0].clientHeight-na)/2+2;Na.css("height",na+"px");Y.css("top",Za+"px");b&&na>=lb?(P=!0,ga(0),ea=oa=!1,e.cancel(c)):!b&&0>=na&&(Y&&Y.remove(),ya=0,ea=!0,a.callLoadComplete(),
e.cancel(c))},20)},ob=function(){db&&e.cancel(db);R&&R.remove()};a.beginLoad=function(a){if(!oa)switch(oa=!0,a?(xa=void 0!=a.type?a.type:"none",La=void 0!=a.speed?a.speed:"normal",Ma=void 0!=a.opacity?a.opacity:0):(xa="none",La="normal",Ma=0),Oa(Ma),xa){case "circular":ob();l.append(R);R.css("top",(l[0].clientHeight-R[0].offsetHeight)/2+"px");R.css("left",(l[0].clientWidth-R[0].offsetWidth)/2+"px");P=!0;ea=oa=!1;var b=0,c=3;switch(La){case "veryfast":c=7;break;case "fast":c=5;break;case "slow":c=
2;break;case "veryslow":c=1}db=e(function(){b+=c;360<b&&(b=0);var a="rotate("+b+"deg)";R.css("-ms-transform",a);R.css("-webkit-transform",a);R.css("transform",a)},1);break;case "linear":a=angular.element('<div class="iui-load-block-progress" style="position:absolute;left:-9999px"></div>');l.append(a);lb=parseInt(getComputedStyle(a[0]).height,10);a.remove();Na.css("width","0px");Na.css("height","0px");l.append(Y);ya=0;Ya=Math.floor(.5*l[0].clientWidth);na=0;Za=l[0].clientHeight/2+2;mb=(l[0].clientWidth-
Ya)/2;Y.css("width",Ya+"px");Y.css("top",Za+"px");Y.css("left",mb+"px");Y.css("opacity","1");nb(!0);break;default:P=!0,ea=oa=!1}};a.endLoad=function(b){if(!$a)if($a=!0,b=a.options.loadItems.indexOf(b),0<=b&&a.options.loadItems.splice(b,1),P){P=!1;var c=3,d=Ma,f=e(function(){ea&&(10<c||1<=d?(Oa(1),$a=oa=ea=!1,xa="none",La="normal",Ma=void 0,e.cancel(f)):(d+=c/10,Oa(d),c+=3))},1)}else $a=!1};var Oa=function(a){w&&w.css("opacity",a);q&&q.css("opacity",a);t&&t.css("opacity",a);M&&M.css("opacity",a)},
Na=angular.element('<div class="iui-load-block-progress"></div>'),Y=angular.element('<div class="iui-load-block"></div>');Y.append(Na);var ya=0,za=!1,R=angular.element('<div class="iui-load-circular"></div>'),ga=function(a){if(P&&"linear"==xa){za=!1;var b=Math.floor(Ya*a/100),c=ya;a=10;switch(La){case "veryfast":a=2;break;case "fast":a=5;break;case "slow":a=15;break;case "veryslow":a=20}var d=b>c?Math.floor((b-c)/a):1,d=0<d?d:1,f=e(function(){c+=d;Na.css("width",c+"px");c>=b&&(ya=b,za=!0,e.cancel(f))},
1)}else za=!0},wa={top:0,bottom:0},Ab=function(){v=0;wa={top:0,bottom:0};if(0<a.currentList.length&&m){for(var b=[],d=[],e=0,f=0;f<a.currentList.length&&10>f;f++)b.push(pb(f,!0)),d.push(c(b[f])(m)),l.append(d[f]),e++;if(0<e)var g=k(function(){var a=0;wa=h.getMargin(d[0][0]);for(var b=0;b<e;b++)a+=d[b][0].offsetHeight,d[b].remove();v=Math.floor(a/e);k.cancel(g)},1)}},Bb=function(){l.append(fa);var b=k(function(){if(0<a.currentList.length){m=g.$new();m.data=qb();m.checkBoxStyle=a.options.checkBoxSettings.style;
!m.checkBoxStyle&&a.options.controlStyle.item.checkBox&&(m.checkBoxStyle=a.options.controlStyle.item.checkBox);a.refresh();m.$apply();Ab();var d=k(function(){var a=l[0].offsetHeight-6;C&&q&&(a-=q[0].offsetHeight);var b=(wa.top+wa.bottom)/2;x=0<v?Math.floor(a/(v+b))+1:100;ba=0;a="";for(b=0;b<x;b++)a+=pb(b),ba++;0<ba&&fa.append(c(a)(m));ga(70);S("scroll");k.cancel(d)},1)}else ga(70),S("scroll");k.cancel(b)},1)},S=function(b){if(za&&!oa)switch(b){case "start":Oa(0);a.updateCurrentList();Cb();ga(10);
S("init");break;case "init":fa&&fa.remove();Ga||ua||kb();V();m&&m.$destroy();a.currentList.length>=x&&E+x-1>a.currentList.length&&(E=a.currentList.length-x+1);ga(20);S("items");break;case "items":Bb();break;case "scroll":a.updateViewSize();a.updateViewSize();a.updateScrollView();ga(80,"complete");S("complete");break;case "complete":ga(90);S("events");break;case "events":fa&&(w.empty(),w.append(fa.children()));a.allowEvents=!0;0<a.currentList.length&&Ra();ga(100);S("end");break;case "end":fa&&fa.remove();
a.callUpdateComplete();switch(xa){case "circular":ob();ya=0;ea=!0;a.callLoadComplete();break;case "linear":nb(!1);break;default:ya=0,ea=!0,a.callLoadComplete()}a.updateActive=!1;a.updateStatus--;0<a.updateStatus&&(za=a.updateActive=!0,S("start"));0==a.updateStatus&&(a.updateView(),Oa(1))}else k(function(){S(b)},1)};a.updateCurrentLayout=function(){if(a.allowUpdate)if(0==a.currentList.length)a.updateLayout();else{a.updateCurrentList();a.updateView();var b=k(function(){a.updateViewSize();a.updateViewSize();
a.updateScrollView();k.cancel(b)},1)}};a.updateLayout=function(b){b=!0;for(var c=l.parent();"body"!=c[0].tagName.toLowerCase();){if("none"==getComputedStyle(c[0]).display){b=!1;break}c=c.parent()}if(b&&a.allowUpdate&&(a.updateStatus++,!a.updateActive)){a.updateActive=!0;l.removeClass("iui-treeview-block-rtl");a.options.rtl&&l.addClass("iui-treeview-block-rtl");w.removeClass("iui-treeview-block-shift-left iui-treeview-block-rtl");w.addClass(Da());a.allowEvents=!1;v=X=0;x=100;if(a.options.showCheckBoxes)for(a.updateCheckValues(),
b=a.getFullList(),c=0;c<b.length;c++)a.setDefaultCheckValue(b[c]);za=!0;S("start")}};g.$watch(function(){return l[0].offsetWidth},function(b,c){100==x?a.updateLayout():b!=c&&a.updateCurrentLayout()});var W=null;g.$watch(function(){return l[0].offsetHeight},function(b,c){b!=c&&(W&&(k.cancel(W),W=null),W=k(function(){a.updateLayout();k.cancel(W);W=null},250))});g.onCheckValueChanging=function(b,c){var d=!1,e=c+E;if(a.isIndexInRange(e)){if((d=a.currentList[e])&&0==d[a.options.dataFields.allowEdit])return!1;
d=a.callCheckValueChanging(a.currentList[e],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)}return d};g.onCheckValueChanged=function(b,c){var d=c+E;a.isIndexInRange(d)&&(a.callCheckValueChanged(a.currentList[d],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked),a.fillCheckList(a.currentList[d]))};a.setDefaultCheckValue=function(b){a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?void 0==b[a.options.dataFields.checkState]&&
(b[a.options.dataFields.checkState]="unchecked"):void 0==b[a.options.dataFields.checked]&&(b[a.options.dataFields.checked]=!1)};var zb=function(b,c){var d=a.currentList[b],e=a.defaultStyle.item.general.normal,f=a.getCurrentItemStyle(d,a.getObjState(d)),d='<li class="'+e;f!=e&&(d+=" "+f);d+='" ';d=c?d+('style="position:absolute;top:-9999px;padding-left:'+a.indentList[b]+'px"'):d+('data-index="'+b+'"');!c&&0<a.indentList[b]&&(d=a.options.rtl?d+(' style="padding-right:'+a.indentList[b]+'px"'):d+(' style="padding-left:'+
a.indentList[b]+'px"'));d+=">";!1!==a.options.showStatusIcons&&(d+='<span class="'+ib(a.currentList[b])+'" data-element="statusicon"></span>');d+='<span class="'+aa(a.currentList[b])+'" data-element="expandbox"></span>';1==a.options.showCheckBoxes&&(d+='<iui-checkbox name="cb-'+h.getUniqueId(4)+'"',e=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,f=a.currentList[b],e&&void 0==f[a.options.dataFields.checkState]?f[a.options.dataFields.checkState]="unchecked":void 0==f[a.options.dataFields.checked]&&
(f[a.options.dataFields.checked]=!1),e?(d+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',d=d+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"')+' three-state="true"'):(d+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',d=d+(' checked-changing="onCheckValueChanging(e, '+b+')"')+(' checked-changed="onCheckValueChanged(e, '+b+')"')),m&&(a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&m.checkBoxStyle?
d+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&m.checkBoxStyle&&(d+=' control-style="checkBoxStyle"')),a.isItemEnabled(a.currentList[b])||(d+=' enabled="false"'),d+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<Aa&&(d+="width: "+Aa+"px;"),d+='"></iui-checkbox>');!1!==a.options.showIcons&&jb(a.currentList[b])&&(d+='<span class="'+hb(a.currentList[b])+'" data-element="icon"></span>');e=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=
e&&(e+=" "+a.options.controlStyle.item.content.normal);f=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(d=d+('<div class="'+e+" "+f+'" data-element="content">')+a.currentList[b][a.options.dataFields.content],d+="</div>"):(d+='<span class="'+e+" "+f+'" data-element="content"',!c&&a.currentList[b].contextMenu&&(d+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),d+=">",d=c?d+a.currentList[b][a.options.dataFields.text]:d+("{{data["+b+"]."+a.options.dataFields.text+
"}}"),d+="</span>");return d+="</li>"},pb=function(b,c){var d='<li iui-class="{{data['+b+'].style.general}}" data-index="{{data['+b+'].index}}"',d=c?d+' style="position:absolute;top:-9999px;left:-9999px;"':a.options.rtl?d+(' iui-style="padding-right:{{data['+b+'].indent}}px"'):d+(' iui-style="padding-left:{{data['+b+'].indent}}px"'),d=d+(' iui-contextmenu menu-items="data['+b+"].item."+a.options.dataFields.contextMenu+'" menu-update="{{data['+b+'].updateContextMenu}}"'),d=d+(' ng-show="data['+b+'].visible" style="position:relative;overflow:hidden;">');
0!=a.options.showStatusIcons&&(d+='<span iui-class="{{data['+b+'].statusIcon}}" data-element="status-icon"></span>');d+='<span iui-class="{{data['+b+'].expandBox}}" data-element="expandbox"';a.getTemplateUrl()&&(d+=0!=a.options.rtl?' style="float:right"':' style="float:left"');d+="></span>";a.options.showExpandBoxes&&1==a.options.showLines&&(d+='<span class="iui-treeview-line" ng-repeat="line in data['+b+'].lines" iui-style="top:{{line.top}}px;left:{{line.left}}px;right:{{line.right}}px;height:{{line.height}}px;width:{{line.width}}px;"></span>');
1==a.options.showCheckBoxes&&(d+='<iui-checkbox name="cb-'+h.getUniqueId(4)+'"',a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?(d+=' check-state="data['+b+"].item."+a.options.dataFields.checkState+'"',d=d+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"')+' three-state="true"'):(d+=' checked="data['+b+"].item."+a.options.dataFields.checked+'"',d=d+(' checked-changing="onCheckValueChanging(e, '+b+')"')+(' checked-changed="onCheckValueChanged(e, '+
b+')"')),m&&(a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&m.checkBoxStyle?d+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&m.checkBoxStyle&&(d+=' control-style="checkBoxStyle"')),d+=' enabled="data['+b+"].item."+a.options.dataFields.enabled+'"',d+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;',0<Aa&&(d+="width: "+Aa+"px;"),d+='" iui-show="{{data['+b+'].visible}}" show-default="true"></iui-checkbox>');a.getTemplateUrl()||0==a.options.showIcons||
(d+='<span iui-class="{{data['+b+'].icon}}" data-element="icon"></span>');a.getTemplateUrl()?(d+='<iui-item-content obj="data['+b+"].item."+a.options.dataFields.templateObj+'" template-url="{{data['+b+'].templateUrl}}" iui-show="{{data['+b+'].templateVisible}}" draggable="{{data['+b+'].draggable}}" tabindex="{{data['+b+'].tabindex}}" data-element="template-content"',"inline"==a.getTemplateDisplay()&&(d+='show-inline="true"'),d+=" ng-cloak></iui-item-content>"):(d=d+('<span iui-class="{{data['+b+'].style.content}}" draggable="{{data['+
b+'].draggable}}" tabindex="{{data['+b+'].tabindex}}" data-element="content"')+(' iui-tooltip="data['+b+"].item."+a.options.dataFields.tooltip+'">'),d+="{{data["+b+"].item."+a.options.dataFields.text+"}}",d+="</span>");return d+"</li>"},Aa=0,Cb=function(){if(1==a.options.showCheckBoxes){var b=angular.element(c('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(g));l.append(b);Aa=0;b&&0<b.children().length&&(Aa=parseInt(getComputedStyle(angular.element(b.children().eq(0))[0]).width,
10));b.remove()}};a.getTemplateDisplay=function(){return a.options.templateSettings?a.options.templateSettings.display:"block"};a.getTemplateUrl=function(){return a.options.templateSettings?a.options.templateSettings.url:null};a.isTherePrevItem=function(b){var c=!1;if(b)for(var d=a.currentList.indexOf(b)-1;0<=d;d--)if(a.currentList[d][a.options.dataFields.pid]==b[a.options.dataFields.pid]){c=!0;break}return c};a.isThereNextItem=function(b){var c=!1;if(b)for(var d=a.currentList.indexOf(b)+1;d<a.currentList.length;d++)if(a.currentList[d][a.options.dataFields.pid]==
b[a.options.dataFields.pid]){c=!0;break}return c};var rb=function(b,c,d,e,f){var g={top:0,left:0==a.options.rtl?c*a.options.indent+7:"auto",right:0!=a.options.rtl?c*a.options.indent+8:"auto",width:0,height:v},h=a.isTherePrevItem(b),k=a.isThereNextItem(b);e?(k||(g.height=Math.floor(v/2)),h||f||(g.height=Math.floor(v/2),g.top=Math.floor(v/2)),(h||k||f)&&d.push(g)):k&&d.push(g);e&&!a.isThereVisibleChildren(b)&&(g={width:8,height:0},g.top=Math.floor(v/2),g.left=0==a.options.rtl?c*a.options.indent+7:"auto",
g.right=0!=a.options.rtl?c*a.options.indent+8:"auto",d.push(g))},Db=function(b,c,d){var e;if(d&&a.options.showExpandBoxes&&1==a.options.showLines)if(a.isThereChildItems||b&&b[a.options.dataFields.hasChildren]){e=a.indentList[c]/a.options.indent;for(var f=b,g=a.parentList[c].parent,h=[],k=e;0<=k&&f;k--)k==e?rb(b,k,h,!0,g):f&&rb(f,k,h,!1,g),f=g,g=a.getItemCurrentIndex(f),g=0<=g&&g<a.parentList.length?a.parentList[g].parent:null;e=h}else e=[];else e=[];var f=d?aa(b):"",h=d?a.isItemEnabled(b)&&a.isDragAllowed(b):
!1,k=d?hb(b):"",g=d?0!=a.options.showIcons&&jb(b):!1,l=d?a.indentList[c]:0,m=d?ib(b):"",p=d?0!=a.options.showStatusIcons&&(b?b[a.options.dataFields.statusIcon]:!1):!1,q;q=d?1==a.options.allowFocus&&a.isItemEnabled(a.currentList[c])?a.getTabIndex().toString()+(c+1).toString():"":"";var u=a.getTemplateUrl(),r;if(d){r=a.getTemplateUrl();var t=a.currentList[c];r=r&&""!=r&&void 0!=t[a.options.dataFields.templateObj]&&null!=t[a.options.dataFields.templateObj]?!0:!1}else r=!1;return{lines:e,expandBox:f,
draggable:h,icon:k,iconVisible:g,indent:l,index:c,item:d?b:{},statusIcon:m,statusIconVisible:p,style:{},tabindex:q,templateUrl:u,templateVisible:r,updateContextMenu:d?null!=b[a.options.dataFields.contextMenu]:!1,visible:d}},qb=function(){for(var b=[],c=E;c<E+x;c++)b.push(Db(a.currentList[c],c,c<a.currentList.length));return b};a.getItemScope=function(){return m};var tb=function(){m&&(a.allowEvents=!1,sb(!1),m.data=qb(),a.options.selectedItem&&!a.isItemEnabled(a.options.selectedItem)&&(a.options.selectedItem[a.options.dataFields.selected]=
!1,a.options.selectedItem=null,a.updateSelectionList()),a.refresh(null,null,!1),m.$apply(),a.allowEvents=!0)};a.updateView=function(a){if(a)tb();else var b=k(function(){tb();k.cancel(b)},1)};a.refresh=function(b,c,d){if(b)switch(b.type){case "item":if(m&&(c=a.getItemCurrentIndex(b)-E,0<=c&&c<m.data.length&&m.data[c].visible)){c=m.data[c];var e=a.getObjState(b),f={content:"",general:"",label:""},g;g=a.defaultStyle.item.general.normal;a.options.controlStyle.item.general.normal!=g&&(g+=" "+a.options.controlStyle.item.general.normal);
f.general=g;g=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=g&&(g+=" "+a.options.controlStyle.item.content.normal);f.content=g;g=a.getCurrentItemStyle(b,e);g!=a.options.controlStyle.item.general.normal&&(f.general+=" "+g);b=a.getCurrentItemContentStyle(b,e);b!=a.options.controlStyle.item.content.normal&&(f.content+=" "+b);c.style=f;void 0==d&&m&&m.$apply()}}else{for(b=E;b<E+x;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):m&&(c=b-E,0<=c&&c<m.data.length&&
m.data[c].visible&&(m.data[c].style=a.defaultStyle.item.general.normal));1==d&&m&&m.$apply()}};a.moveItem=function(b,c,d,e){if(b){a.allowUpdate=!1;var f=-1;switch(d){case "first":f=0;break;case "at":f=e}if(Array.isArray(b)){e=[];for(var g=0;g<b.length;g++){for(var h=!1,k=a.getParent(b[g]);k;){if(0<=b.indexOf(k)){h=!0;break}k=a.getParent(k)}h||e.push(b[g])}if(0<e.length)if(b=a.getObjCurrentIndex(e[0]),g=a.getObjCurrentIndex(e[e.length-1]),b<=g)for(g=0;g<e.length;g++)eb(e[g],c,f,d);else for(g=e.length-
1;0<=g;g--)eb(e[g],c,f,d)}else eb(b,c,f,d);a.allowUpdate=!0;a.updateCurrentLayout();a.callChange()}};var eb=function(b,c,d,e){a.dataObj.removeAt(b,-1,null,a.objIsRemoved)&&("first"==e||"last"==e||"at"==e?a.dataObj.insertAt(b,d,c,a.itemIsAdded):"before"==e?a.dataObj.insertByRef(b,c,!1,a.itemIsAdded):"after"==e&&a.dataObj.insertByRef(b,c,!0,a.itemIsAdded))},Fa=!1,Ba=0,ab=null,fb=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return C;case "vertical":return z}return C&&z};a.prevScrollPos=
{x:0,y:0};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b,c){if(!P&&b){var d=!0;0>b.x&&(b.x=0,d=!1);b.x>B.x&&(b.x=B.x,d=!1);0>b.y&&(b.y=0,d=!1);b.y>B.y&&(b.y=B.y,d=!1);a.scrollPos=b;Ka=Math.floor(a.scrollPos.y/(v*Xa));var e,f=da+Ka;C&&F&&(e=!1!==a.options.rtl?Math.floor(a.scrollPos.x/Ja)-(ma-F[0].offsetWidth-ca):Math.floor(a.scrollPos.x/Ja)+ca,F.css("left",e+"px"));z&&G&&G.css("top",f+"px");ub();sb(!0,c);d&&a.callScrollPosChanged()}};var gb=function(a){return 0<
a.x&&a.x<B.x||0<a.y&&a.y<B.y},Ta=function(b,c,d,f){Fa||(Ba=0,Fa=!0,ab=e(function(){if(1!=b.which)ka();else{var e=d,f=a.getScrollPos();e||(0===Ba&&(Ba=5),Ba+=5+Xa,fb+=.5,e=Ba+=Math.floor(fb));f.y=c?f.y+e:f.y-e;a.setScrollPos(f);(0>=f.y||a.getScrollPos().y<f.y)&&ka()}},f?f:100))},ka=function(){Fa&&(ab&&(e.cancel(ab),ab=null),Fa=!1,Ba=0,fb=.5)};a.cancelScrollTimer=function(){ka()};a.scrollTo=function(b,c){if(b){var d=a.getItemCurrentIndex(b);if(a.isIndexInRange(d)){var e=0,f=d;switch(c){case "center":e=
Math.floor(ba/2);f=d>e?d-e:0;break;case "bottom":e=ba-2,f=d>e?d-e:0}var g=k(function(){a.setScrollPos({x:a.scrollPos.x,y:f*v});k.cancel(g)},1)}}};var vb=function(b){if(!P&&1===b.which){F[0].getBoundingClientRect();b=a.getMousePos(b);I.scrollMousePos||(I.scrollMousePos=b);var c=F[0].offsetLeft+(b.x-I.scrollMousePos.x);c<ca?c=ca:c+F[0].offsetWidth>ma&&(c=ma-F[0].offsetWidth);F.css("left",c+"px");I.scrollMousePos=b;a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.scrollPos.x=!1!==a.options.rtl?parseInt((ma-
F[0].offsetLeft-F[0].offsetWidth)*Ja,10):parseInt((F[0].offsetLeft-ca)*Ja,10);ub();(gb(a.scrollPos)||a.scrollPos.x!=a.prevScrollPos.x)&&a.callScrollPosChanged()}},ub=function(){if(w){var b=a.scrollPos.x;0>b&&(b=0);b>B.x&&(b=B.x);b=2-b;!1!==a.options.rtl?w.css("right",b+"px"):w.css("left",b+"px")}},wb=function(b){if(!P&&1===b.which){G[0].getBoundingClientRect();b=a.getMousePos(b);I.scrollMousePos||(I.scrollMousePos=b);var c=G[0].offsetTop+(b.y-I.scrollMousePos.y);c<da?c=da:c+G[0].offsetHeight>va&&
(c=va-G[0].offsetHeight);G.css("top",c+"px");I.scrollMousePos=b;Ka=c-da;a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.scrollPos.y=Math.floor(Ka*Xa*v);(gb(a.scrollPos)||a.scrollPos.y!=a.prevScrollPos.y)&&a.callScrollPosChanged();newIndex=0<v?Math.floor(a.scrollPos.y/v):0;newIndex+x-1>=a.currentList.length&&(newIndex=a.currentList.length-x+1,newIndex+=5);0>newIndex&&(newIndex=0);newIndex!==E&&(E=newIndex,a.updateView(!0))}},sb=function(b,c){if(!(0==b&&0>=v)){newIndex=0<v?Math.floor(a.scrollPos.y/
v):0;a.scrollPos.y==B.y&&newIndex--;if(a.currentList.length>=x&&newIndex+x-1>a.currentList.length){newIndex=a.currentList.length-x+1;var d=w.find("li");d&&0<d.length&&(d=angular.element(d[d.length-1]),d[0].offsetTop+d[0].offsetHeight>l[0].clientHeight&&newIndex++)}0>newIndex&&(newIndex=0);newIndex!==E&&(E=newIndex,0!=b&&a.updateView(c))}};l.bind("scroll",function(a){l[0].scrollTop=0;l[0].scrollLeft=0});var xb=function(b,c){if(z){document.activeElement&&document.activeElement.blur();var d=a.hoverItem;
a.hoverItem=null;a.refresh(d);d=Math.floor(l[0].clientHeight/4);a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+d*c*-1});gb(a.scrollPos)||a.scrollPos.y==a.prevScrollPos.y||a.callScrollPosChanged()}};l.bind("mousewheel",function(b){b.preventDefault();if(!P&&a.options.enabled){var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));xb(b,
c)}});l.bind("DOMMouseScroll",function(b){b.preventDefault();if(!P&&a.options.enabled){var c=0;b.detail?c=Math.max(-1,Math.min(1,-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,-b.originalEvent.detail)));xb(b,c)}});l.bind("mousemove",function(a){Ga?vb(a):ua&&wb(a);a.stopPropagation()});angular.element(J).bind("dragover",function(a){ka()});angular.element(J).bind("dragend",function(b){a.dragDropStatus(!1)});angular.element(J).bind("mousemove",function(a){Ga?vb(a):ua&&wb(a)});angular.element(J).bind("mouseup",
function(b){a.dropMark();ua&&a.updateView();ka();I.scrollMousePos=null;ua=Ga=!1});var Pa={x:0,y:0},ha={x:0,y:0};l.bind("touchstart",function(b){b.preventDefault();a.options.enabled&&(b=a.getTouchData(b))&&0<b.length&&(Pa={x:b[0].pageX,y:b[0].pageY})});l.bind("touchend",function(b){if(a.options.enabled){(b=a.getTouchData(b))&&0<b.length&&(ha={x:b[0].pageX,y:b[0].pageY});var c=ha.x-Pa.x,d=ha.y-Pa.y;(20<Math.abs(c)||20<Math.abs(d))&&document.activeElement&&document.activeElement.blur();var f=!1,g=!1,
h=Pa,k=a.scrollPos.x,l=a.scrollPos.y,m=e(function(){var b=a.scrollPos;-20>c?(h.x-=10,h.x>ha.x?b.x+=10:(b.x=k-c,f=!0)):20<c?(h.x+=10,h.x<ha.x?b.x-=10:(b.x=k-c,f=!0)):f=!0;-20>d?(h.y-=10,h.y>ha.y?b.y+=10:(b.y=l-d,g=!0)):20<d?(h.y+=10,h.y<ha.y?b.y-=10:(b.y=l-d,g=!0)):g=!0;a.setScrollPos(b);f&&g&&e.cancel(m)},5);Pa=ha}});angular.isDefined(g.options)?a.updateOptions(g.options):(0==g.allowAnimation&&(a.options.allowAnimation=g.allowAnimation),1==g.allowDrag&&(a.options.allowDrag=g.allowDrag),0==g.allowDrop&&
(a.options.allowDrop=g.allowDrop),angular.isDefined(g.animationSpeed)&&200!==g.animationSpeed&&(a.options.animationSpeed=g.animationSpeed),0==g.allowFocus&&(a.options.allowFocus=g.allowFocus),1==g.autoCheck&&(a.options.autoCheck=g.autoCheck),0==g.autoExpand&&(a.options.autoExpand=g.autoExpand),angular.isDefined(g.checkboxSettings)&&a.updateCheckBoxSettings(g.checkboxSettings),angular.isDefined(g.controlStyle)&&a.updateControlStyle(g.controlStyle),angular.isDefined(g.editorSettings)&&a.updateEditorSettings(g.editorSettings),
0==g.enabled&&(a.options.enabled=g.enabled),angular.isDefined(g.fields)&&(a.updateDataFields(g.fields),a.updateData()),!0===g.hoverSelection&&(a.options.hoverSelection=g.hoverSelection),angular.isDefined(g.indent)&&(a.options.indent=g.indent),angular.isDefined(g.itemIcon)&&(a.options.itemIcon=g.itemIcon),angular.isDefined(g.labelEdit)&&(a.options.labelEdit=g.labelEdit),!0===g.rtl&&(a.options.rtl=g.rtl),angular.isDefined(g.selectedIndex)&&(a.options.selectedIndex=g.selectedIndex),angular.isDefined(g.selectedItem)&&
(a.options.selectedItem=g.selectedItem),angular.isDefined(g.selectionMode)&&(a.options.selectionMode=g.selectionMode),!0===g.showCheckBoxes&&(a.options.showCheckBoxes=g.showCheckBoxes),!1===g.showExpandBoxes&&(a.options.showExpandBoxes=g.showExpandBoxes),!1===g.showIcons&&(a.options.showIcons=g.showIcons),!0===g.showLines&&(a.options.showLines=g.showLines),!0===g.showStatusIcons&&(a.options.showStatusIcons=g.showStatusIcons),angular.isDefined(g.sorting)&&(a.options.sorting=g.sorting),angular.isDefined(g.templateSettings)&&
a.updateTemplateSettings(g.templateSettings));var Eb=k(function(){a.updateLayout();k.cancel(Eb)},250)}}}]);